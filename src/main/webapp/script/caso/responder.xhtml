<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:go="http://java.sun.com/jsf/composite/go">

    <h:form id="message-details-reply" rendered="#{casoController.selected.open}">

        <p:panel styleClass="panel" rendered="#{not casoController.replyMode}">
            <p style="color: #999;">
                Haz click para  
                <strong><p:commandLink actionListener="#{casoController.enableCommentMode()}" value=" Agregar un Comentario"  styleClass="fa fa-comment"
                                       update="message-details-reply"/></strong>
                ,
                <strong><p:commandLink actionListener="#{casoController.enableReplyMode(false)}" value=" Responder" styleClass="fa fa-reply"
                                       update="message-details-reply"/></strong>
                o <strong><p:commandLink actionListener="#{casoController.enableReplyMode(true)}" value=" Responder a Todos" styleClass="fa fa-reply-all"
                                         update="message-details-reply"/></strong>
            </p>
        </p:panel>

        <h:panelGroup layout="block" id="message-details-reply"  styleClass="panel form-horizontal"
                      rendered="#{(casoController.replyMode) and ((casoController.verificarCrearActividad()))}"> 

            <div class="panel-heading">
                <span class="panel-title">

                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <span class="fa #{casoController.replyByEmail ? 'fa-reply':'fa-comment'}"></span> <i class="fa fa-caret-down"></i></button>

                        <ul class="dropdown-menu">
                            <li>
                                <p:commandLink rendered="#{casoController.replyByEmail}" immediate="true"
                                               styleClass="btn-link" actionListener="#{casoController.enableCommentMode()}"
                                               disabled="#{casoController.selected.closed}"
                                               update="@parent"
                                               process="@form"
                                               ajax="true">
                                    <i class="fa fa-comment"></i> Cambiar a modo Comentario       
                                </p:commandLink>
                            </li>
                            <li>
                                <p:commandLink rendered="#{not casoController.replyByEmail}" immediate="true"
                                               styleClass="btn-link" actionListener="#{casoController.enableReplyMode(false)}"
                                               disabled="#{casoController.selected.closed}"
                                               update="@parent"
                                               process="@form"
                                               ajax="true">
                                    <i class="fa fa-reply"></i> Responder a #{casoController.selected.emailCliente.emailCliente}        
                                </p:commandLink>
                            </li><li>
                                <p:commandLink rendered="#{not casoController.replyByEmail}" immediate="true"
                                               styleClass="btn-link" actionListener="#{casoController.enableReplyMode(true)}"
                                               disabled="#{casoController.selected.closed}"
                                               update="@parent"
                                               process="@form"
                                               ajax="true">
                                    <i class="fa fa-reply-all"></i> Responder a todos         
                                </p:commandLink>
                            </li>
                        </ul>
                    </div>
                </span>
                <div class="panel-heading-controls">

                    <div class="btn-group">
                        <h:selectOneMenu id="clipping" value="#{casoController.selectedClipping}" 
                                         styleClass="form-control">
                            <f:selectItem itemValue="" itemLabel="#{bundle.textoPredefinido}" />
                            <f:selectItems value="#{clippingController.itemsAvailableSelectMany}"/>
                            <p:ajax update="@form" process="@form" 
                                    listener="#{casoController.handleClippingSelectChangeEvent}" />
                        </h:selectOneMenu>
                    </div>
                    <h:panelGroup layout="block"  class="btn-group btn-group-xs pull-right" rendered="#{not casoController.replyByEmail}">
                        <h:selectBooleanCheckbox 
                            id="textoNotaVisibilidadPublica" value="#{casoController.textoNotaVisibilidadPublica}" 
                            styleClass="switcher form-control input-sm"/>
                        <script type="text/javascript">
                            $(function () {$('.switcher').switcher({
                                theme: 'square',
                                on_state_content: ' PÃºblico ',
                                off_state_content: ' Privado '
                            });});
                        </script>
                    </h:panelGroup>
                </div>
            </div>


            <div class="panel-body">

                <h:panelGroup layout="block" id="paneldest"  rendered="#{casoController.replyByEmail}" styleClass="form-group">
                    <label class="col-sm-1 control-label" for="otroEmail">Para</label>
                    <div class="col-sm-10">
                        <p:autoComplete id="otroEmail"  multiple="true" emptyMessage="No matches found"
                                        placeholder="Email addresses" 
                                        value="#{casoController.otroEmail}" 
                                        required="true" requiredMessage="Favor agregar un destinatario para este mensaje."
                                        completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="true"/>
                    </div>

                    <div class="col-sm-1 pull-right">
                        <div class="form-group">
                            <div class="btn-group">
                                <p:commandLink id="cclink" immediate="true" rendered="#{casoController.replyByEmail}"
                                               value="cc" process="@form"
                                               actionListener="#{casoController.changeCCO(true)}"
                                               update="@form" styleClass="btn-link">
                                </p:commandLink>
                            </div>
                            <div class="btn-group">
                                <p:commandLink id="ccolink" immediate="true" rendered="#{casoController.replyByEmail}"
                                               value="cco" process="@form"
                                               actionListener="#{casoController.changeCCO(false)}"
                                               update="@form" styleClass="btn-link">
                                </p:commandLink>
                            </div>
                        </div>
                    </div><!-- reply to -->
                </h:panelGroup>

                <h:panelGroup layout="block" id="panelcc" rendered="#{casoController.replyByEmail and casoController.cc}" styleClass="form-group">
                    <label class="col-sm-1 control-label" for="otroEmailcc">CC</label>
                    <div class="col-sm-10">
                        <p:autoComplete id="otroEmailcc" 
                                        placeholder="Email addresses"
                                        multiple="true" value="#{casoController.ccEmail}" completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="false">
                        </p:autoComplete>
                    </div>
                </h:panelGroup>

                <h:panelGroup layout="block" id="panelcco" rendered="#{casoController.replyByEmail and casoController.cco}" 
                              styleClass="form-group">
                    <label class="col-sm-1 control-label" for="otroEmailcco">CCO</label>
                    <div class="col-sm-10">
                        <p:autoComplete id="otroEmailcco" 
                                        placeholder="Email addresses"
                                        multiple="true" value="#{casoController.ccoEmail}" completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="false">
                        </p:autoComplete>
                    </div>
                </h:panelGroup>


                <h:panelGroup layout="block" styleClass="no-margin-t no-padding-t">
                    <pe:ckEditor id="textonota" value="#{casoController.textoNota}" 
                                 language="es" rendered="#{not casoController.mobileClient}"
                                 toolbar="#{applicationBean.ckEditorToolbar}"
                                 customConfig="#{request.contextPath}/resources/js/ckeditor.js"
                                 required="true"  width="100%" /> 
                    <p:watermark for="textonota" value="Comments" rendered="#{not casoController.mobileClient}"/>
                    <h:message for="textonota" errorClass="text-danger" />

                </h:panelGroup> 


                <h:panelGroup layout="block">

                    <div class="col-sm-3">
                        <div class="form-group no-margin-hr">
                            <h:outputLabel styleClass="control-label"
                                           value="#{bundle.EditCasoLabel_idSubEstado}" for="idSubEstado"/>
                            <h:selectOneMenu id="idSubEstado" styleClass="form-control"  rendered="#{!casoController.selected.closed}"
                                             required="true" requiredMessage="El subestado es requerido"
                                             value="#{casoController.selected.idSubEstado}" >

                                <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}" var="subEstad" itemDescription="#{subEstad.description}"/>
                            </h:selectOneMenu>
                            <h:outputText styleClass="label" 
                                          style="background: \##{casoController.selected.idSubEstado.backgroundColor}; color: \##{casoController.selected.idSubEstado.fontColor};" value="#{casoController.selected.idSubEstado.nombre}"
                                          rendered="#{casoController.selected.closed}"/>
                        </div>
                    </div><!-- col-sm-6 -->

                    <h:panelGroup id="nextResponseDueP" layout="block" styleClass="col-sm-3">
                        <div class="form-group no-margin-hr">
                            <h:outputLabel 
                                styleClass="control-label"
                                value="#{bundle.EditCasoLabel_nextResponseDue}" for="nextResponseDue" />
                            <h:inputText id="nextResponseDue" styleClass="form-control datepicker" disabled="#{casoController.selected.closed}" 
                                         title="#{bundle.EditCasoTitle_nextResponseDue}" value="#{casoController.selected.nextResponseDue}" 
                                         required="true" requiredMessage="Favor ingrese un valor para el sla.">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:inputText>


                            <script type="text/javascript">
                                $(function () {
                                    $('.datepicker').datetimepicker({
                                        language: 'es',
                                        format: 'dd/mm/yyyy hh:ii',
                                        viewformat: 'dd/mm/yyyy hh:ii',
                                        todayBtn: true,
                                        autoclose: true,
                                        todayHighlight: true,
                                        weekStart: 1,
                                        forceParse: true
                                    });
                                });
                            </script>

                        </div>
                    </h:panelGroup><!-- col-sm-6 -->

                    <h:panelGroup id="parchivos" layout="block" styleClass="col-sm-6" rendered="#{casoController.replyByEmail}">
                        <div class="form-group no-margin-hr">
                            <h:outputLabel 
                                styleClass="control-label"
                                value="Adjuntos" for="listaadjuntosrespuesta" />

                            <h:selectManyListbox id="listaadjuntosrespuesta" 
                                                 styleClass="form-control select2Multiple"
                                                 value="#{casoController.selectedAttachmensForMail}" 
                                                 converter="attachmentConverter">
                                <f:selectItems value="#{casoController.selected.attachmentsNotEmbedded}" 
                                               var="item" itemLabel="${item.nombreArchivo}" itemValue="${item}" />
                            </h:selectManyListbox>

                        </div>


                        <script type="text/javascript">
                            $(function () {
                                $("select.select2Input").select2({
                                    dropdownAutoWidth: true,
                                    allowClear: true
                                });

                                $("select.select2Multiple").select2({
                                    dropdownAutoWidth: true,
                                    allowClear: true
                                });
                            });
                        </script>

                    </h:panelGroup>





                </h:panelGroup>



            </div>  

            <div class="panel-footer">


                <div class="btn-group">
                    <p:commandLink action="#{casoController.disableReplyMode()}" styleClass="btn btn-default btn-flat"
                                   immediate="true" update=":message-details-reply">
                        Cancelar
                    </p:commandLink>
                </div>

                <div class="btn-group">
                    <p:commandLink actionListener="#{casoController.crearNota(true)}" 
                                   styleClass="btn btn-info btn-flat" rendered="#{not casoController.replyByEmail}"
                                   update=":mainform:messages :formint1 :info-panel :formact :message-details-reply"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-comment"></i> Guardar y notificar al cliente
                    </p:commandLink>
                </div>

                <div class="btn-group">
                    <p:commandLink actionListener="#{casoController.crearNota(false)}" 
                                   styleClass="btn btn-primary btn-flat"
                                   rendered="#{not casoController.replyByEmail}"
                                   update=":mainform:messages :formint1 :info-panel :formact :message-details-reply"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-comment"></i> Guardar
                    </p:commandLink>
                </div>

                <div class="btn-group">
                    <div class="btn-group dropup pull-right">

                        <button type="button" class="btn btn-primary btn-outline dropdown-toggle btn-flat" data-toggle="dropdown">
                            <i class="fa fa-caret-up"></i></button>
                        <ul class="dropdown-menu">

                            <li>  
                                <p:commandLink actionListener="#{casoController.descartarBorrador()}"
                                               update=":mainform:messages"
                                               rendered="#{casoController.selected.respuesta ne null}">
                                    <i class=""></i> Descartar borrador
                                </p:commandLink>
                            </li>
                            <li> 
                                <p:commandLink actionListener="#{casoController.guardarBorrador()}"
                                               update=":mainform:messages">
                                    <i class="fa fa-disk"></i> Guardar borrador
                                </p:commandLink>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="btn-group">
                    <p:commandLink actionListener="#{casoController.responder(true)}" 
                                   styleClass="btn btn-info btn-flat" rendered="#{casoController.replyByEmail}"
                                   update=":mainform:messages :formint1 :info-panel :formact :message-details-reply"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-envelope"></i> Enviar c/Historia
                    </p:commandLink>
                </div>

                <div class="btn-group">
                    <p:commandLink actionListener="#{casoController.responder(false)}" 
                                   styleClass="btn btn-primary btn-flat" rendered="#{casoController.replyByEmail}"
                                   update=":mainform:messages :formint1 :info-panel :formact :message-details-reply"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-envelope"></i> Enviar
                    </p:commandLink>
                </div>



            </div>



        </h:panelGroup>

    </h:form>

</ui:composition>
