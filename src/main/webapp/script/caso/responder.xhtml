<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:go="http://java.sun.com/jsf/composite/go">

    <h:form id="message-details-reply" rendered="#{casoController.selected.open}">

        <p:panel styleClass="panel" rendered="#{not casoController.replyMode}">
            <p style="color: #999;">
                Haz click para  
                <strong><p:commandLink actionListener="#{casoController.enableCommentMode()}" value=" Agregar un Comentario"  styleClass="fa fa-comment"
                                       update="message-details-reply"/></strong>
                ,
                <strong><p:commandLink actionListener="#{casoController.enableReplyMode(false)}" value=" Responder" styleClass="fa fa-reply"
                                       update="message-details-reply"/></strong>
                o <strong><p:commandLink actionListener="#{casoController.enableReplyMode(true)}" value=" Responder a Todos" styleClass="fa fa-reply-all"
                                         update="message-details-reply"/></strong>
            </p>
        </p:panel>


        <h:panelGroup layout="block" id="message-details-reply"  styleClass="panel form-horizontal"
                      rendered="#{(casoController.replyMode) and ((casoController.verificarCrearActividad()))}"> 

            <div class="panel-heading">
                <span class="panel-title">
                    <i class="panel-title-icon fa #{casoController.replyByEmail ? 'fa-reply':'fa-comment'}"></i>#{casoController.replyByEmail ? 'Responder':'Agregar comentario'}</span>
                <div class="panel-heading-controls">

                        <div class="btn-group">
                            <h:selectOneMenu id="clipping" value="#{casoController.selectedClipping}" styleClass="form-control input-sm select2Input">
                                <f:selectItem itemValue="" itemLabel="#{bundle.textoPredefinido}" />
                                <f:selectItems value="#{clippingController.itemsAvailableSelectMany}"/>
                                <p:ajax update="textonota" process="@this" listener="#{casoController.handleClippingSelectChangeEvent}" />
                            </h:selectOneMenu>
                        </div>
                        <h:panelGroup layout="block"  class="btn-group btn-group-xs pull-right" rendered="#{not casoController.replyByEmail}">
                            <h:selectBooleanCheckbox 
                                id="textoNotaVisibilidadPublica" value="#{casoController.textoNotaVisibilidadPublica}" 
                                styleClass="switcher form-control input-sm"/>
                            <script type="text/javascript">
                                $('.switcher').switcher({
                                    theme: 'square',
                                    on_state_content: ' PÃºblico ',
                                    off_state_content: ' Privado '
                                });
                            </script>
                        </h:panelGroup>
                </div>
            </div>


            <div class="panel-body">

                <h:panelGroup layout="block" id="paneldest"  rendered="#{casoController.replyByEmail}"
                              styleClass="row form-group">
                    <label class="col-sm-2 control-label" for="otroEmail"><p:outputLabel value="Para" for="otroEmail"/></label>
                    <div class="col-sm-9">
                        <p:autoComplete id="otroEmail" style="width: 100%;"  multiple="true" emptyMessage="No matches found"
                                        placeholder="Email addresses" 
                                        value="#{casoController.otroEmail}" 
                                        required="true" requiredMessage="Favor agregar un destinatario para este mensaje."
                                        completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="true"/>
                    </div>

                    <div class="col-sm-1 pull-right">
                        <div class="form-group">
                            <div class="btn-group">
                                <p:commandLink id="cclink" immediate="true" rendered="#{casoController.replyByEmail}"
                                               value="cc" process="@this,otroEmail,otroEmailcc,otroEmailcco"
                                               actionListener="#{casoController.changeCCO(true)}"
                                               update="@this :message-details-reply">
                                </p:commandLink>
                            </div>
                            <div class="btn-group">
                                <p:commandLink id="ccolink" immediate="true" rendered="#{casoController.replyByEmail}"
                                               value="cco" process="@this,otroEmail,otroEmailcc,otroEmailcco"
                                               actionListener="#{casoController.changeCCO(false)}"
                                               update="@this :message-details-reply">
                                </p:commandLink>
                            </div>

                        </div>
                    </div><!-- col-sm-6 -->
                </h:panelGroup>
                <h:panelGroup layout="block" id="panelcc" rendered="#{casoController.replyByEmail and casoController.cc}" 
                              styleClass="row form-group">
                    <label class="col-sm-2 control-label" for="otroEmailcc"><p:outputLabel value="CC" for="otroEmailcc"/></label>
                    <div class="col-sm-10">
                        <p:autoComplete style="width: 100%;" id="otroEmailcc" 
                                        placeholder="Email addresses"
                                        multiple="true" value="#{casoController.ccEmail}" completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="false">
                        </p:autoComplete>
                    </div>
                </h:panelGroup>
                <h:panelGroup layout="block" id="panelcco" rendered="#{casoController.replyByEmail and casoController.cco}" 
                              styleClass="row form-group">
                    <label class="col-sm-2 control-label" for="otroEmailcco"><p:outputLabel value="CCO" for="otroEmailcco"/></label>
                    <div class="col-sm-10">
                        <p:autoComplete style="width: 100%;" id="otroEmailcco" 
                                        placeholder="Email addresses"
                                        multiple="true" value="#{casoController.ccoEmail}" completeMethod="#{emailClienteController.completeEmailClienteString}"
                                        var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="false">
                        </p:autoComplete>
                    </div>
                </h:panelGroup>

                <h:panelGroup layout="block" styleClass="row form-group no-padding">
                  
                    <go:textAreaEditor id="textonota" fieldValue="#{casoController.textoNota}"
                                       mobile="#{casoController.mobileClient}" watermark="Comments"
                                               required="true" requiredMessage="Ingrese sus comentarios"/>
                </h:panelGroup>

                <h:panelGroup layout="block" styleClass="row">

                    <div class="col-sm-5">
                        <div class="form-group no-margin-hr">
                            <h:outputLabel styleClass="control-label"
                                           value="#{bundle.EditCasoLabel_idSubEstado}" for="idSubEstado"/>
                            <h:selectOneMenu id="idSubEstado" styleClass="form-control"  rendered="#{!casoController.selected.closed}"
                                             required="true" requiredMessage="El subestado es requerido"
                                             value="#{casoController.selected.idSubEstado}" >

                                <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}" var="subEstad" itemDescription="#{subEstad.description}"/>
                            </h:selectOneMenu>
                            <h:outputText styleClass="label" 
                                          style="background: \##{casoController.selected.idSubEstado.backgroundColor}; color: \##{casoController.selected.idSubEstado.fontColor};" value="#{casoController.selected.idSubEstado.nombre}"
                                          rendered="#{casoController.selected.closed}"/>
                        </div>
                    </div><!-- col-sm-6 -->

                    <div class="col-sm-5">
                        <div class="form-group no-margin-hr">
                            <h:outputLabel 
                                styleClass="control-label"
                                value="#{bundle.EditCasoLabel_nextResponseDue}" for="nextResponseDue" />
                            <h:inputText id="nextResponseDue" styleClass="form-control datepicker" disabled="#{casoController.selected.closed}" 
                                         title="#{bundle.EditCasoTitle_nextResponseDue}" value="#{casoController.selected.nextResponseDue}" 
                                         required="true" requiredMessage="Favor ingrese un valor para el sla.">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:inputText>


                        </div>
                    </div><!-- col-sm-6 -->

                    <div class="col-sm-2">
                        <div class="form-group">

                            <p:commandLink id="attlink" immediate="true" rendered="#{casoController.replyByEmail}"
                                           value="Adjuntos" 
                                           actionListener="#{casoController.setAdjuntarArchivosARespuesta(not casoController.adjuntarArchivosARespuesta)}"
                                           update="@this :message-details-reply:parchivos">
                            </p:commandLink>

                        </div>
                    </div><!-- col-sm-6 -->
                </h:panelGroup>

                <h:panelGroup layout="block" styleClass="row list-group">
                    <p:panel id="parchivos" visible="#{casoController.replyByEmail and casoController.adjuntarArchivosARespuesta}">
                        <h:panelGrid columns="2" >
                            <p:outputLabel for="listaadjuntosrespuesta" value="Seleccione adjuntos" style="font-weight:bold"/>

                            <p:selectManyCheckbox id="listaadjuntosrespuesta" value="#{casoController.selectedAttachmensForMail}" layout="grid" columns="2"
                                                  converter="attachmentConverter">
                                <f:selectItems value="#{casoController.selected.attachmentsNotEmbedded}" 
                                               var="item" itemLabel="${item.nombreArchivo}" itemValue="${item}" />
                            </p:selectManyCheckbox>
                        </h:panelGrid>
                    </p:panel>
                </h:panelGroup>

            </div>  

            <div class="panel-footer">

                <div class="btn-group">
                    <p:commandLink action="#{casoController.disableReplyMode()}" styleClass="btn btn-default"
                                   immediate="true" update=":message-details-reply">
                        <i class="fa fa-chevron-left"></i> Cancelar
                    </p:commandLink>
                </div>
                <div class="pull-right" role="toolbar">
                    <div class="btn-group">
                        <p:commandLink actionListener="#{casoController.crearNota(false)}" 
                                       styleClass="btn btn-primary"
                                       rendered="#{not casoController.replyByEmail}"
                                       update=":mainform:messages :formint1 :info-panel :formact :message-details-reply">
                            <i class="fa fa-comment"></i> Guardar comentario
                        </p:commandLink>
                    </div>

                    <div class="btn-group">
                        <p:commandLink actionListener="#{casoController.crearNota(true)}" 
                                       styleClass="btn btn-primary" rendered="#{not casoController.replyByEmail}"
                                       update=":mainform:messages :formint1 :info-panel :formact :message-details-reply">
                            <i class="fa fa-comment"></i> Guardar comentario y notificar al cliente  <i class="fa fa-envelope-o"></i>
                        </p:commandLink>
                    </div>

                    <div class="btn-group">
                        <p:commandLink actionListener="#{casoController.responder()}" 
                                       styleClass="btn btn-primary" rendered="#{casoController.replyByEmail}"
                                       update=":mainform:messages :formint1 :info-panel :formact :message-details-reply">
                            <i class="fa fa-envelope"></i> Enviar
                        </p:commandLink>
                    </div>

                    <div class="btn-group">
                        <div class="btn-group dropup pull-right">

                            <button type="button" class="btn btn-primary  dropdown-toggle" data-toggle="dropdown"><i class="fa fa-caret-up"></i></button>
                            <ul class="dropdown-menu">

                                <li>  
                                    <p:commandLink actionListener="#{casoController.descartarBorrador()}"
                                                   update=":mainform:messages"
                                                   rendered="#{casoController.selected.respuesta ne null}">
                                        <i class=""></i> Descartar borrador
                                    </p:commandLink>
                                </li>
                                <li> 
                                    <p:commandLink actionListener="#{casoController.guardarBorrador()}"
                                                   update=":mainform:messages">
                                        <i class=""></i> Guardar borrador
                                    </p:commandLink>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

        </h:panelGroup>

    </h:form>

</ui:composition>
