<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:go="http://java.sun.com/jsf/composite/go">
    <ui:composition template="/script/template_inbox.xhtml">
        <ui:define name="title">
            <h:outputText value="Caso #{casoController.selected.idCaso}: #{casoController.selected.tema}"></h:outputText>
        </ui:define>

        <ui:define name="head">
            <style type="text/css">
                .ui-autocomplete-multiple-container{
                    width: 100% !important;
                }
                .ui-panelgrid-odd{
                    //background: none repeat scroll 0 0 #F2F5F9;
                }

                .ui-panelgrid-even{
                    //background: none repeat scroll 0 0 #F2F5F9;
                }
            </style>

        </ui:define>

        <ui:define name="west">
            <p:accordionPanel cache="false" multiple="true" id="westPanel" activeIndex="#{casoController.activeIndexWestPanel}">        

                <p:ajax event="tabChange"/>

                <p:tab title="Info">
                    <h:form id="formint1">

                        <p:panelGrid style="margin-bottom:10px;" styleClass="filtersGrid" id="panelGridDatos"  >

                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Datos Cliente</h2>
                                    </div>
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Nombre:" for="clienteNotNull" style="font-weight:bold"/>
                                </p:column>
                                <p:column>
                                    <p:commandLink id="clienteNotNull" value="#{casoController.selected.clientName}" style="color: #4183C4 !important;"
                                                   update=":formDatosCliente" onclick="PF('dialogClient').show()" />
                                </p:column>
                            </p:row>


                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Creado/Modificado/SLA</h2>
                                    </div>
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="C/M/SLA" for="fechaCreacion" style="font-weight:bold"/>
                                </p:column>
                                <p:column>

                                    <h:panelGrid columns="6">

                                        <h:outputText id="fechaCreacion" value="#{casoController.formatShortDate(casoController.selected.fechaCreacion)}"/>

                                        <h:outputText value=" / "/>
                                        <h:outputText id="fechaModif" value="#{casoController.formatShortDate(casoController.selected.fechaModif)}"/>
                                        <h:outputText value=" / "/>
                                        <pe:switch id="switchTicketAlertState" value="#{casoController.selected.isOpen().toString()}">  
                                            <pe:case value="true">  
                                                <pe:switch id="switchTicketAlertStateOpen" value="#{casoController.selected.estadoAlerta}">  
                                                    <pe:case value="#{EnumTipoAlerta.TIPO_ALERTA_PENDIENTE.getTipoAlerta()}">  
                                                        <div class="fa-hover" style="color: #5cb85c;"><i class="fa fa-clock-o"></i> &nbsp;
                                                            <h:outputText id="nextResponseDue" 
                                                                          value="#{casoController.formatShortDate(casoController.selected.nextResponseDue)}"/>
                                                            <p:tooltip for="nextResponseDue" value="Acuerdo de respuesta #{casoController.prettyDate(casoController.selected.nextResponseDue)} - #{casoController.formatDate(casoController.selected.nextResponseDue)}"/>
                                                        </div>
                                                    </pe:case>
                                                    <pe:case value="#{EnumTipoAlerta.TIPO_ALERTA_POR_VENCER.getTipoAlerta()}">  
                                                        <div class="fa-hover" style="color: #f0ad4e;"><i class="fa fa-warning"></i> &nbsp;
                                                            <h:outputText id="nextResponseDue" 
                                                                          value="#{casoController.formatShortDate(casoController.selected.nextResponseDue)}"/>
                                                            <p:tooltip for="nextResponseDue" value="Vence #{casoController.prettyDate(casoController.selected.nextResponseDue)} - #{casoController.formatDate(casoController.selected.nextResponseDue)}"/>
                                                        </div>
                                                    </pe:case>
                                                    <pe:case value="#{EnumTipoAlerta.TIPO_ALERTA_VENCIDO.getTipoAlerta()}">  
                                                        <div class="fa-hover" style="color: #c9302c;"><i class="fa fa-exclamation"></i> &nbsp;
                                                            <h:outputText id="nextResponseDue" 
                                                                          value="#{casoController.formatShortDate(casoController.selected.nextResponseDue)}"/>
                                                            <p:tooltip for="nextResponseDue" value="Vencido #{casoController.prettyDate(casoController.selected.nextResponseDue)} - #{casoController.formatDate(casoController.selected.nextResponseDue)}"/>
                                                        </div>
                                                    </pe:case>  
                                                </pe:switch>  
                                            </pe:case> 

                                            <pe:case value="false">  
                                                <div class="fa-hover" style="color: #000;"><i class="fa fa-lock"></i> &nbsp;
                                                    <h:outputText id="cerrado" 
                                                                  value="#{casoController.formatShortDate(casoController.selected.fechaCierre)}"/>
                                                    <p:tooltip for="cerrado" value="Cerrado #{casoController.prettyDate(casoController.selected.fechaCierre)} - #{casoController.formatDate(casoController.selected.fechaCierre)}"/>
                                                </div>
                                            </pe:case>  
                                        </pe:switch>  

                                    </h:panelGrid>


                                    <p:tooltip for="fechaModif" value="Ultima modificaciÃ³n #{casoController.prettyDate(casoController.selected.fechaModif)} - #{casoController.formatDate(casoController.selected.fechaModif)}"/>

                                    <p:tooltip for="fechaCreacion" value="Creado #{casoController.prettyDate(casoController.selected.fechaCreacion)} - #{casoController.formatDate(casoController.selected.fechaCreacion)}"/>


                                </p:column>
                            </p:row>


                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Datos del Caso</h2>
                                    </div>
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Tipo de caso:" style="font-weight:bold"/>
                                </p:column>

                                <p:column>
                                    <p:inplace  editor="true" emptyLabel="sin tipo" saveLabel="Guardar">
                                        <p:ajax event="save" update=":westPanel:formint1 :formCerrarCaso" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.tipoCaso ne null ? casoController.selected.tipoCaso:'sin tipo'}" />
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">

                                            <p:selectOneMenu id="idTipoCaso" style="width: 220px;" disabled="#{casoController.selected.closed}" converter="TipoCasoControllerConverter"
                                                             required="true" requiredMessage="El tipo de caso es requerido."
                                                             filter="true" filterMatchMode="contains"
                                                             value="#{casoController.selected.tipoCaso}" >
                                                <f:selectItems value="#{applicationBean.tipoCasoAvailableList}" var="tipo" 
                                                               itemLabel="#{tipo.nombre}" itemValue="#{tipo}" itemDescription="#{tipo.descripcion}"/>
                                            </p:selectOneMenu>

                                        </f:facet>
                                    </p:inplace>
                                </p:column>
                            </p:row>



                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{bundle.EditCasoLabel_idPrioridad}" for="idPrioridad" style="font-weight:bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <p:ajax event="save" update=":westPanel:formint1 :formCerrarCaso" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idPrioridad.nombre}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu disabled="#{casoController.selected.closed}" style="width: 220px;"
                                                             required="true"
                                                             id="idPrioridad" value="#{casoController.selected.idPrioridad}" >
                                                <f:selectItems value="#{prioridadController.itemsAvailableSelectMany}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>


                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{bundle.EditCasoLabel_owner}" for="owner" style="font-weight:bold"/>
                                </p:column>

                                <p:column>
                                    <p:commandLink id="owner" actionListener="#{usuarioController.prepareViewUserInDialog(casoController.selected.owner)}"  
                                                   value="#{casoController.selected.owner.capitalName}" 
                                                   immediate="true"
                                                   style="color: #4183C4 !important;"
                                                   disabled="#{casoController.selected.closed or not usuarioController.puedeEditar(casoController.selected.owner)}" 
                                                   title="Ver Datos del Agente" />
                                </p:column>
                            </p:row>



                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{bundle.EditCasoLabel_idCanal}" for="idCanal" style="font-weight:bold"/>
                                </p:column>
                                <p:column>
                                    <h:outputText id="idCanal" value="#{casoController.selected.idCanal.nombre}" title="#{bundle.EditCasoTitle_idCanal}"/>
                                </p:column>
                            </p:row>



                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Area:" style="font-weight:bold"/>
                                </p:column>
                                <p:column>
                                    <p:inplace  editor="true" emptyLabel="sin area" saveLabel="Guardar">
                                        <p:ajax event="save" update=":westPanel:formint1 :formCerrarCaso" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idArea}" />
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu disabled="#{casoController.selected.closed}" id="idAreaCaso" style="width: 220px;"
                                                             filter="true" filterMatchMode="contains"
                                                             value="#{casoController.selected.idArea}" >
                                                <f:selectItem itemLabel="" itemValue=""/>
                                                <f:selectItems value="#{applicationBean.areasAvailableList}" var="tipo" itemLabel="#{tipo.nombre}" itemValue="#{tipo}" itemDescription="#{tipo.descripcion}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>
                                </p:column>

                            </p:row>

                            <p:row rendered="#{casoController.selected.idCasoPadre ne null}">
                                <p:column>
                                    <p:outputLabel value="#{bundle.EditCasoLabel_idCasoPadre}"  style="font-weight:bold"/>
                                </p:column>
                                <p:column>
                                    <h:commandLink id="idCasoPadre" action="#{casoController.filterByIdCaso(casoController.selected.idCasoPadre.idCaso)}" value="${casoController.selected.idCasoPadre.tipoCaso.nombre} NÂ°${casoController.selected.idCasoPadre.idCaso} - ${casoController.selected.idCasoPadre.tema}"/>
                                </p:column>
                            </p:row>


                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Datos del Producto</h2>
                                    </div>
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="#{applicationBean.productDescription}:" for="idProducto" style="font-weight:bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <p:ajax event="save" listener="#{casoController.handleProductChange}" update="idComponente modeloProductoId" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idProducto.nombre}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu disabled="#{casoController.selected.closed or casoController.casoTipoReparacion}" id="idProducto" filter="true" filterMatchMode="contains" style="width: 220px;"
                                                             value="#{casoController.selected.idProducto}" >
                                                <f:selectItems value="#{productoController.itemsAvailableSelectOne}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>



                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel value="Modelo:" for="modeloProductoId" style="font-weight:bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <p:ajax event="save" update="idComponente" listener="#{casoController.onProductoModeloChosen()}" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idModelo.nombre}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="modeloProductoId" disabled="#{casoController.selected.closed or casoController.casoTipoReparacion}" filter="true" filterMatchMode="contains" style="width: 220px;"
                                                             value="#{casoController.selected.idModelo}" >
                                                <f:selectItem itemLabel="" itemValue=""/>
                                                <f:selectItems value="#{casoController.selected.idProducto.modeloProductoList}" var="m" itemValue="#{m}" itemLabel="#{m.nombre}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>

                                </p:column>
                            </p:row>



                            <p:row rendered="#{not casoController.casoTipoPreventa}">
                                <p:column>
                                    <h:outputLabel value="#{applicationBean.productComponentDescription}:" for="idComponente" style="font-weight: bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <p:ajax event="save" update="idSubComponente"  listener="#{casoController.handleProductChange}" />
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idComponente.nombre}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="idComponente"  value="#{casoController.selected.idComponente}"  style="width: 220px;"
                                                             filter="true" filterMatchMode="contains"
                                                             disabled="#{casoController.selected.closed or casoController.selected.idProducto eq null or casoController.casoTipoReparacion}">
                                                <f:selectItem itemLabel="" itemValue=""/>
                                                <f:selectItems value="#{casoController.selected.idProducto.componenteList}" var="comp" itemLabel="#{comp.nombre}" itemValue="#{comp}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>


                                </p:column>
                            </p:row>

                            <p:row rendered="#{not casoController.casoTipoPreventa}">
                                <p:column>
                                    <h:outputLabel value="#{applicationBean.productSubComponentDescription}:" for="idSubComponente" style="font-weight: bold"/>
                                </p:column>

                                <p:column style="padding-left: 0px !important;">


                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar" disabled="#{casoController.selected.closed or casoController.selected.idComponente eq null or casoController.casoTipoReparacion}">
                                        <f:facet name="output">

                                            <h:panelGrid style="width: 220px;">
                                                <p:row>
                                                    <p:column >
                                                        <h:outputText value="#{casoController.selected.idSubComponente.nombre}"/>
                                                        <i class="fa fa-search" title="cambiar de #{applicationBean.productSubComponentDescription}"></i>    
                                                    </p:column>
                                                    <p:column>
                                                        &nbsp;
                                                        <p:commandButton action="#{productoController.prepareViewSubComponente(casoController.selected.idSubComponente, '/script/caso/Edit')}" 
                                                                         ajax="false" value="Editar"
                                                                         icon="fa fa-external-link"
                                                                         rendered="#{filtroAcceso.verificarAccesoAFuncionEditarAjustes() and not(casoController.selected.closed or casoController.selected.idComponente eq null or casoController.casoTipoReparacion)}"
                                                                         title="Modificar datos de #{casoController.selected.idSubComponente.nombre}"/>
                                                    </p:column>
                                                </p:row>
                                            </h:panelGrid>

                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="idSubComponente" value="#{casoController.selected.idSubComponente}"  style="width: 150px;"
                                                             filter="true" filterMatchMode="contains"
                                                             disabled="#{casoController.selected.closed or casoController.selected.idComponente eq null or casoController.casoTipoReparacion}">
                                                <f:selectItem itemLabel="" itemValue=""/>
                                                <f:selectItems value="#{casoController.selected.idComponente.subComponenteList}" var="subc" itemLabel="#{subc.nombre}" itemValue="#{subc}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>

                                </p:column>
                            </p:row>




                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Etiquetas</h2>
                                    </div>
                                </p:column>
                            </p:row>


                            <p:row>

                                <p:column colspan="2">

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <ul style="padding-left: 0px;">
                                                <ui:repeat value="#{casoController.selected.etiquetaStringList}" var="idTag">
                                                    <li data-token-value="#{idTag}" class="ui-autocomplete-token ui-state-active ui-corner-all">
                                                        <p:commandLink actionListener="#{casoController.onTagIdSelectCaso(idTag)}">
                                                            <span class="ui-autocomplete-token-label">#{idTag}</span>
                                                        </p:commandLink>
                                                    </li>
                                                </ui:repeat>
                                            </ul>

                                            <i class="fa fa-edit" title="Editar etiquetas"></i> 

                                        </f:facet>
                                        <f:facet name="input">
                                            <p:autoComplete id="tags" disabled="#{casoController.selected.closed}" 
                                                            value="#{casoController.selected.etiquetaStringList}" forceSelection="true" 
                                                            completeMethod="#{applicationBean.findEtiquetasByPattern}" multiple="true">
                                                <p:ajax  event="itemSelect"  listener="#{casoController.tagItemSelectEvent}"  update=":mainform:messages"  />
                                                <p:ajax  event="itemUnselect"  listener="#{casoController.tagItemUnselectEvent}"  update=":mainform:messages"  />
                                            </p:autoComplete>
                                            <p:watermark for="tags" value="Etiquetas"/>
                                        </f:facet>
                                    </p:inplace>
                                </p:column>
                            </p:row>




                            <p:row>
                                <p:column colspan="2">
                                    <div class="formSeparator">
                                        <h2>Campos adicionales</h2>
                                    </div>
                                </p:column>
                            </p:row>

                            <p:row rendered="#{(casoController.selected.tipoCaso eq EnumTipoCaso.REPARACION_ITEM.getTipoCaso()) 
                                               or (casoController.selected.tipoCaso eq EnumTipoCaso.PREVENTIVO.getTipoCaso())}">
                                <p:column>
                                    <p:outputLabel value="Responsable" for="idResponsable" style="font-weight:bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idResponsable.nombreResponsable}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu disabled="#{casoController.selected.closed}" style="width: 220px;"
                                                             id="idResponsable" value="#{casoController.selected.idResponsable}" >
                                                <f:selectItems value="#{responsableController.itemsAvailableSelectOne}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:inplace>


                                </p:column>
                            </p:row>

                            <p:row rendered="#{(casoController.selected.tipoCaso eq EnumTipoCaso.REPARACION_ITEM.getTipoCaso()) 
                                               or (casoController.selected.tipoCaso eq EnumTipoCaso.PREVENTIVO.getTipoCaso())}">
                                <p:column>
                                    <h:outputLabel value="Servicio TÃ©cnico:" for="idTechnicalService" style="font-weight:bold;"/>
                                </p:column>
                                <p:column>
                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.servicioTecnico eq true ? 'Si':'No'}"/>
                                            <i class="fa fa-edit"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectBooleanCheckbox id="idTechnicalService" disabled="#{casoController.selected.closed}" 
                                                                     value="#{casoController.selected.servicioTecnico}" />
                                        </f:facet>
                                    </p:inplace>
                                </p:column>
                            </p:row>

                            <p:row rendered="#{casoController.casoTipoPreventa}">
                                <p:column>
                                    <h:outputLabel value="CrÃ©dito Preaprobado:" for="credito" style="font-weight: bold"/>
                                </p:column>
                                <p:column>
                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.creditoPreAprobado eq true ? 'Si':'No'}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectBooleanCheckbox id="credito" value="#{casoController.selected.creditoPreAprobado}"  disabled="#{casoController.selected.closed}"/> 
                                        </f:facet>
                                    </p:inplace>
                                </p:column>
                            </p:row>

                            <p:row rendered="#{casoController.casoTipoPreventa}">
                                <p:column>
                                    <h:outputLabel value="Fecha est. Compra:" for="fechaCompra" style="font-weight: bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.prettyDate(casoController.selected.fechaEstimadaCompra)}"/>
                                            <i class="fa fa-edit"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">

                                            <p:calendar locale="es" navigator="true" id="fechaCompra" showButtonPanel="true" 
                                                        mindate="#{applicationBean.now}" style="width: 220px;"
                                                        disabled="#{casoController.selected.closed}"
                                                        value="#{casoController.selected.fechaEstimadaCompra}"  
                                                        title="Fecha estimada de compra" pattern="dd/MM/yyyy" label="Fecha est. Compra:"/>

                                        </f:facet>
                                    </p:inplace>


                                </p:column>
                            </p:row>

                            <p:row rendered="#{casoController.casoTipoReparacion}">
                                <p:column>
                                    <h:outputLabel value="Recinto:" for="Recinto" style="font-weight: bold"/>
                                </p:column>

                                <p:column>

                                    <p:inplace  editor="true" emptyLabel="vacÃ­o" saveLabel="Guardar">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.selected.idRecinto}"/>
                                            <i class="fa fa-search"></i>                                           
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="Recinto" value="#{casoController.selected.idRecinto}"  style="width: 220px;" editable="true"
                                                             filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{recintoController.itemsAvailableSelectMany}" var="r" itemLabel="#{r.idRecinto}" itemValue="#{r.idRecinto}"/>
                                            </p:selectOneMenu> 
                                        </f:facet>
                                    </p:inplace>


                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column colspan="2">
                                    <ui:repeat id="tableCustomFields" var="customField" value="#{customFieldController.getCurrentCasoCustomFieldList(casoController.selected)}">
                                        <h:panelGrid columns="2">
                                            <h:outputLabel value="#{customField.customField.label}:" for="customFieldI"  style="font-weight: bold"/>

                                            <go:customField id="customFieldI0" rendered="#{customField.customField.required eq true and empty customField.valor}"
                                                            casoCustomFieldValue="#{customField}" 
                                                            casoOpen="#{casoController.selected.isOpen()}"/>

                                            <p:inplace  editor="true" rendered="#{customField.customField.required eq false or not empty customField.valor}"
                                                        emptyLabel="vacÃ­o" saveLabel="Guardar">
                                                <f:facet name="output">
                                                    <h:outputText value="#{customField.valor}"/>
                                                    <i class="fa fa-search"></i>                                           
                                                </f:facet>
                                                <f:facet name="input">
                                                    <go:customField id="customFieldI" casoCustomFieldValue="#{customField}" casoOpen="#{casoController.selected.isOpen()}"/>
                                                </f:facet>
                                            </p:inplace>

                                        </h:panelGrid>
                                        <br/>
                                    </ui:repeat>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="2">

                                    <p:commandButton disabled="#{casoController.selected.closed or not (casoController.verificarGrabarCaso())}" style="float: right"   
                                                     value="Guardar" icon="ui-icon-disk" action="#{casoController.update}" 
                                                     update=":botoneraCaso :westPanel:formint1"/>

                                </p:column>
                            </p:row>

                        </p:panelGrid>



                    </h:form>
                </p:tab>



            </p:accordionPanel>

        </ui:define>

        <ui:define name="body">
            <pe:importEnum type="com.itcs.helpdesk.persistence.entityenums.EnumTipoAlerta" var="EnumTipoAlerta" allSuffix="ALL_ENUM_VALUES" />
            <pe:importEnum type="com.itcs.helpdesk.persistence.entityenums.EnumTipoCaso" var="EnumTipoCaso" allSuffix="ALL_ENUM_VALUES" />


            <pe:layoutPane id="layoutcenter" position="center" >

                <pe:layoutPane id="layout1_North" position="north" size="70px" minHeight="70px" maxHeight="70px" closable="false" maxSize="70px">              

                    <h:form id="botoneraCaso" style="margin-top: 5px;">
                        <h:panelGrid columns="14">     

                            <p:commandButton ajax="false" title="#{casoController.selected.idCasoPadre ne null ? 'Subir al caso '.concat(casoController.selected.idCasoPadre):'Ir al listado de casos'}" icon="fa fa-level-up" action="#{casoController.goOneLevelUp()}" style="width: 60px;"/>

                            <p:commandButton ajax="false" title="Actualizar" icon="fa fa-refresh" actionListener="#{casoController.refreshCaso()}" style="width: 60px;"/>
                            <p:commandButton rendered="#{casoController.verificarTomarCaso()}" ajax="true" value="AsignÃ¡rmelo" onclick="PF('tomarCaso').show()" />




                            <p:commandButton rendered="#{casoController.verificarCerrarCaso()}"
                                             ajax="true" value="Cerrar" onclick="PF('closeCase').show();"/>

                            <p:commandButton rendered="#{casoController.verificarReabrirCaso()}" ajax="true" value="Reabrir Caso" onclick="PF('openCase').show();" />

                            <p:commandButton ajax="false" icon="fa fa-download" value="Generar Acta de PreEntrega" 
                                             rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}">
                                <p:fileDownload value="#{casoController.generarActaPreEntrega()}" />
                            </p:commandButton>

                            <p:commandButton id="panelBotonesResp" value="Otras acciones" type="button" />
                            <p:menu overlay="true" trigger="panelBotonesResp" my="left top" at="left bottom" style="width:250px !important;">

                                <p:menuitem rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.PREVENTIVO.getTipoCaso()}"
                                            value="Generar Documento Visita Preventiva" 
                                            title="Generar Documento Visita Preventiva"                                                 
                                            actionListener="#{casoController.generarPDFVisitaPreventivaPostventa()}"
                                            icon="fa fa-file"  />

                                <p:menuitem ajax="false" value="Copiar" action="#{casoController.prepareCopy()}"/>

                                <p:menuitem ajax="false" value="Copiar y AsignÃ¡rmelo" action="#{casoController.prepareCopyAndAssignMe()}"/>

                                <p:menuitem rendered="#{casoController.verificarTransferirCaso()}"
                                            ajax="true" value="Transferir" onclick="PF('transferir').show();"/>
                                <p:menuitem rendered="#{casoController.verificarCrearColaborativo()}"
                                            ajax="false" value="Crear Caso Colaborativo" action="#{casoController.crearCasoColab(casoController.selected)}"/>
                                <p:menuitem rendered="#{casoController.verificarAsignarCaso()}"
                                            ajax="true" value="Asignar" onclick="PF('transferir').show();" />
                                <p:menuitem rendered="#{casoController.verificarRelacionarCaso()}"
                                            ajax="true" value="Relacionar Otro Caso" onclick="PF('casosRela').show();"/>

                                <p:menuitem rendered="#{casoController.verificarEliminarCaso()}"
                                            ajax="true" value="Eliminar" onclick="PF('destroyCase').show();"/>
                            </p:menu>

                            <p:commandButton icon="ui-icon ui-icon-seek-prev" ajax="false"
                                             action="#{casoController.prepareEditPreviusItem()}" 
                                             title="Ir al caso anterior"
                                             disabled="#{casoController.selectedItemIndex eq casoController.pagination.pageFirstItem}"
                                             rendered="#{casoController.pagination.itemsCount > 0}"/>



                            <p:commandButton icon="ui-icon ui-icon-seek-next" ajax="false"
                                             action="#{casoController.prepareEditNextItem()}" 
                                             title="Ir al caso siguiente"
                                             disabled="#{casoController.selectedItemIndex eq casoController.pagination.pageLastItem}"
                                             rendered="#{casoController.pagination.itemsCount > 0}"/>
                        </h:panelGrid>

                        <h:panelGroup id="tituloCaso">



                            <p:panelGrid styleClass="filtersGrid" id="panelGridDatos">
                                <p:row>
                                    <p:column>
                                        <p:inplace editor="true">
                                            <f:facet name="output">
                                                <p:outputLabel style="font-size: 18px !important;"
                                                               value="#{casoController.selected.tipoCaso ne null ? casoController.selected.tipoCaso.nombre:'Caso' } NÂ°#{casoController.selected.idCaso}: #{casoController.selected.tema}"/>
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputText id="ticketTema" value="#{casoController.selected.tema}"/> 
                                                <p:watermark for="ticketTema" value="Asunto del caso"/>
                                            </f:facet>
                                        </p:inplace>
                                    </p:column>

                                    <p:column>
                                        <h:commandLink id="prio" disabled="#{casoController.selected.closed}" >
                                            <p:graphicImage library="images" name="#{casoController.selected.esPrioritario ? 'star-enabled.png':'star-disabled.png'}" title="Importante!"/>
                                            <p:ajax id="aj2" listener="#{casoController.changePriority(casoController.selected, casoController.selected.esPrioritario)}" update="prio :formTopMenu"/>

                                        </h:commandLink>
                                    </p:column>

                                    <p:column>
                                        <h:outputText styleClass="ticket-status" value="#{casoController.selected.idEstado.nombre}"
                                                      style="#{casoController.selected.isOpen() eq true ? 'background: #4abf5a; color: #FFFFFF;':'background: #444444; color: #FFFFFF;'}"/>
                                    </p:column>
                                    <!-- Ticket Alert status -->
                                    <p:column>
                                        <h:outputText id="idSubEstado" styleClass="ticket-status" 
                                                      style="background: \##{casoController.selected.idSubEstado.backgroundColor}; color: \##{casoController.selected.idSubEstado.fontColor};" 
                                                      value="#{casoController.selected.idSubEstado.nombre}"/>
                                    </p:column>

                                    <p:column>
                                        <h:panelGroup rendered="#{casoController.selected.hasScheduledEvents}">
                                            <i class="fa fa-calendar"></i>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{casoController.selected.hasAttachments}">
                                            <i class="fa fa-paperclip"></i>    
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>




                        </h:panelGroup>
                    </h:form>



                    <p:separator />

                </pe:layoutPane>

                <pe:layoutPane id="layout1_1" position="center">

                    <p:tabView id="inputPanel" dynamic="true" cache="false"  activeIndex="#{casoController.activeIndexCasoSections}">
                        <p:ajax event="tabChange" listener="#{casoController.onChangeActiveIndexCasoSections}" />
                        <p:ajax event="tabClose" listener="#{casoScheduleController.onTabClose}" />

                        <p:tab id="tabDesc" title="#{bundle.CreateCasoTitle_descripcion}" >  

                            <h:form id="formDesc">

                                <h:panelGrid cellpadding="10">  

                                    <p:inplace editor="true">
                                        <f:facet name="output">
                                            <h:outputText value="#{(casoController.selected.descripcionTxt eq null) ? casoController.parseHtmlToText(casoController.selected.descripcion):casoController.selected.descripcionTxt}" escape="false"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <pe:ckEditor id="ticketDesc" value="#{casoController.selected.descripcionTxt}" 
                                                         language="es"
                                                 toolbar="#{applicationBean.ckEditorToolbar}"
                                                 required="true"  width="100%" /> 
                                            <p:watermark for="ticketDesc" value="DescripciÃ³n del caso"/>
                                        </f:facet>
                                    </p:inplace>


                                    <p:separator/>
                                    <p:panelGrid id="link" styleClass="filtersGrid" style="width: 100%;">
                                        <p:row>
                                            <p:column >
                                                <i class="fa fa-picture-o" style="float: right;"></i>
                                            </p:column>
                                            <p:column >
                                                <div align="left" style="font-size: x-small;">
                                                    <i>Oprima sobre la descripciÃ³n si desea editar. La descripci&oacute;n del caso se muestra en texto plano por seguridad, para ver versi&oacute;n original haz click en 
                                                    </i>
                                                </div>
                                            </p:column>
                                            <p:column>
                                                <p:commandLink actionListener="#{casoController.prepareViewHtml(casoController.selected.descripcion)}" 
                                                               style="color: #15c;font-size: x-small;"
                                                               value="ver mensaje HTML" />
                                            </p:column>

                                        </p:row>
                                    </p:panelGrid>


                                    <p:panelGrid style="margin-bottom:10px;" styleClass="filtersGrid" id="panelGridDatos" >
                                        <p:row rendered="#{casoController.casoTipoReparacion}">
                                            <p:column>
                                                <h:outputLabel value="Item:" for="item" style="font-weight: bold"/>
                                            </p:column>
                                        </p:row>
                                        <p:row rendered="#{casoController.casoTipoReparacion}">
                                            <p:column>
                                                <p:commandButton id="item" immediate="true" style="width: 100%;"
                                                                 value="#{(casoController.selected.idItem eq null) ? 'Elegir item':casoController.selected.idItem}" 
                                                                 update=":formArbolItem:arbol" oncomplete="PF('idDialogArbolItem').show()"/>                                  
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>


                                </h:panelGrid>  
                            </h:form>

                        </p:tab>  


                        <p:tab id="tab-actividades" title="Actividades" >
                            <h:form id="formact">
                                <p:panel id="panelActividades" header="Actividad" toggleable="true" toggleSpeed="100" widgetVar="panelNotas" style="border-color: window;">

                                    <h:panelGrid columns="9" rendered="#{casoController.selected.hasNotas()}">
                                        <p:graphicImage value="/images/view-pim-notes.png" width="22" height="22"/>
                                        <h:outputText value="Comentarios:"/>
                                        <h:outputText value="#{casoController.cantidadDeNotas}" />

                                        <p:graphicImage value="/images/email_out.png" width="22" height="22"/>
                                        <h:outputText value="Respuestas:"/>
                                        <h:outputText value="#{casoController.cantidadDeRespuestasACliente}" />

                                        <p:graphicImage value="/images/email_in.png" width="22" height="22"/>
                                        <h:outputText value="Comentarios del solicitante:"/>
                                        <h:outputText value="#{casoController.cantidadDeRespuestasDelCliente}" />
                                    </h:panelGrid>    

                                    <p:accordionPanel multiple="true" id="listanotas" rendered="#{casoController.selected.hasNotas()}">
                                        <c:forEach items="#{casoController.selected.notaList}" var="item" >
                                            <p:tab title="#{casoController.creaTituloDeNota(item)} - #{item.visible?'Publico':'Interno'}" 
                                                   titletip="#{item.fechaCreacion} - #{item.enviadoA}"
                                                   titleStyleClass="#{casoController.getNotaStyle(item.tipoNota)}">

                                                <p:commandButton actionListener="#{casoController.prepareEditNota(item)}" style="float: right"
                                                                 update=":formEditNota"
                                                                 onsuccess="PF('Nota').show();" rendered="#{casoController.notaEditable(item)}" value="Editar" />
                                                <p:commandButton rendered="false"
                                                                 actionListener="#{casoController.prepareViewHtml(item.texto)}" value="ver mensaje HTML" style="float: right"/>


                                                <h:outputText value="#{item.texto}" escape="false"/>
                                                <p:separator/>

                                                <c:forEach items="#{item.attachmentList}" var="nota_f_attachment" >
                                                    <h:panelGrid columns="6">
                                                        <p:graphicImage name="file_extension_#{nota_f_attachment.fileExtension}.png" library="file_extension_icons" />

                                                        <p:commandLink ajax="false" value="#{nota_f_attachment.nombreArchivoOriginal}" 

                                                                       title="Descargar #{nota_f_attachment.nombreArchivo} (#{nota_f_attachment.mimeType})">
                                                            <p:fileDownload value="#{casoController.bajarArchivo(nota_f_attachment.idAttachment)}" />
                                                        </p:commandLink>

                                                        <h:outputText value="#{nota_f_attachment.fileSizeHuman}" style="color: #7A7A7A"/>


                                                        <p:lightBox iframe="true" iframeTitle="#{nota_f_attachment.nombreArchivoOriginal}"
                                                                    rendered="#{nota_f_attachment.isPdf() or nota_f_attachment.isImage()}"> 
                                                            <h:outputLink  value="#{facesContext.externalContext.requestContextPath}/DownloadFileServlet?id=#{nota_f_attachment.idAttachment}" 
                                                                           styleClass="ui-icon ui-icon-search"
                                                                           title="Preview">  
                                                            </h:outputLink>
                                                        </p:lightBox>


                                                    </h:panelGrid>
                                                </c:forEach>
                                                <p:effect type="highlight" event="load" rendered="#{casoController.justCreadedNotaId eq item.idNota}"/> 
                                            </p:tab>
                                        </c:forEach>
                                    </p:accordionPanel>
                                    <p:outputLabel value="No se registra actividad." rendered="#{not casoController.selected.hasNotas()}"/>
                                </p:panel>
                            </h:form>
                        </p:tab>

                        <p:tab id="tabComments" title="Responder o comentar" 
                               disabled="#{((not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso()))}">  

                            <h:form id="formCreateNota">

                                <h:panelGrid width="100%">

                                    <p:panelGrid styleClass="filtersGrid" style="width: 100%;">

                                        <p:row>
                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <p:outputLabel for="clipping" value="#{bundle.textoPredefinido}" style="font-weight:bold"/>
                                                    <p:selectOneMenu id="clipping" value="#{casoController.selectedClipping}" filter="true" filterMatchMode="contains">
                                                        <f:selectItems value="#{casoController.clippingsItemsAvailableSelectOne}"/>
                                                        <p:ajax update="textonota" process="@parent" listener="#{casoController.handleClippingSelectChangeEvent}" />
                                                    </p:selectOneMenu>
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <p:outputLabel for="textoNotaVisibilidadPublica" value="#{bundle.visibleAlCliente}" style="font-weight:bold"/>
                                                    <p:selectBooleanCheckbox id="textoNotaVisibilidadPublica" value="#{casoController.textoNotaVisibilidadPublica}" />
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column colspan="2">
                                                <p:panelGrid styleClass="filtersGrid" id="panelOtroEmail">
                                                    <p:row>
                                                        <p:column>
                                                            <p:outputLabel for="checkResponderAOtro" value="#{bundle.responderAOtroCorreo}" style="font-weight:bold"/>
                                                        </p:column>
                                                        <p:column>
                                                            <p:selectBooleanCheckbox id="checkResponderAOtro" value="#{casoController.responderAOtroEmail}" >
                                                                <p:ajax update=":inputPanel:formCreateNota"/>
                                                            </p:selectBooleanCheckbox>
                                                        </p:column>
                                                    </p:row>
                                                </p:panelGrid>
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column colspan="2">
                                                <h:panelGrid columns="2">  
                                                    <p:outputLabel for="nextResponseDue1" value="#{bundle.cambiarSLA}" style="font-weight:bold"/>
                                                    <p:calendar locale="es" navigator="true" id="nextResponseDue1" showButtonPanel="true"
                                                                mindate="#{applicationBean.now}" 
                                                                value="#{casoController.selected.nextResponseDue}" 
                                                                required="true" requiredMessage="Favor ingrese un valor para el sla."
                                                                title="Next Follow Up Due" pattern="dd/MM/yyyy HH:mm" label="SLA:"/>

                                                </h:panelGrid>
                                            </p:column>
                                            <p:column colspan="2">
                                                <h:panelGrid columns="2">  
                                                    <p:outputLabel value="#{bundle.cambiarSubEstado}:" for="idSubEstadox" style="font-weight:bold"/>
                                                    <p:selectOneMenu rendered="#{not casoController.selected.closed}" id="idSubEstadox" value="#{casoController.selected.idSubEstado}" >
                                                        <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}"/>
                                                    </p:selectOneMenu>

                                                    <p:selectOneMenu rendered="#{casoController.selected.closed}" id="idSubEstado2" value="#{casoController.selected.idSubEstado}" >
                                                        <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoCerrado}"/>
                                                    </p:selectOneMenu>
                                                </h:panelGrid>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                    
                                    <h:panelGrid columns="4">
                                        <p:message for="nextResponseDue1"/>
                                        <p:message for="idSubEstadox"/>
                                        <p:message for="textonota"/>
                                    </h:panelGrid>

                                    <p:panelGrid styleClass="filtersGridParaOtroEmail" id="panelParaOtroEmail" style="width: 100%;" rendered="#{casoController.responderAOtroEmail}">
                                        <p:row>
                                            <p:column colspan="1">
                                                <p:outputLabel value="#{bundle.etiquetaDestinatarioRespuestaCaso}:" for="otroEmail" />
                                            </p:column >
                                            <p:column colspan="10">
                                                <p:autoComplete style="width: 100%;" id="otroEmail" multiple="true" value="#{casoController.otroEmail}" completeMethod="#{emailClienteController.completeEmailClienteString}"
                                                                var="email"  itemValue="#{email}" itemLabel="#{email}"  forceSelection="false">
                                                </p:autoComplete>
                                                <p:watermark for="otroEmail" value="email destino"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                    <pe:ckEditor id="textonota" value="#{casoController.textoNota}" language="es"
                                                 toolbar="#{applicationBean.ckEditorToolbar}"
                                                 required="true"  width="100%" />

                                    <h:panelGrid columns="2">
                                        <h:panelGrid columns="2">
                                            <p:selectBooleanCheckbox id="addHistory" value="#{casoController.incluirHistoria}" />
                                            <p:outputLabel value="Agregar historia" for="addHistory" style="font-weight:bold"/>
                                        </h:panelGrid>

                                        <h:panelGrid columns="2">
                                            <p:selectBooleanCheckbox id="adjuntarArchivosARespuesta" value="#{casoController.adjuntarArchivosARespuesta}" 
                                                                     disabled="#{casoController.cantidadAttachment() le 0}">
                                                <p:ajax update=":inputPanel:formCreateNota:parchivos" process="@this"/>  
                                            </p:selectBooleanCheckbox>
                                            <p:outputLabel for="adjuntarArchivosARespuesta" value="#{bundle.adjuntarArchivosARespuesta}" style="font-weight:bold"/>
                                        </h:panelGrid>
                                    </h:panelGrid>

                                    <p:panel id="parchivos" visible="#{casoController.adjuntarArchivosARespuesta}">
                                        <h:panelGrid columns="2" >
                                            <p:outputLabel for="listaadjuntosrespuesta" value="Seleccione adjuntos" style="font-weight:bold"/>

                                            <p:selectManyCheckbox id="listaadjuntosrespuesta" value="#{casoController.selectedAttachmensForMail}" layout="grid" columns="3">
                                                <f:selectItems value="#{casoController.selected.attachmentsNotEmbedded}" 
                                                               var="item" itemLabel="${item.nombreArchivo}" itemValue="${item.idAttachment}" />
                                            </p:selectManyCheckbox>
                                        </h:panelGrid>
                                    </p:panel>

                                    <br/>
                                    <h:panelGrid style="float: right">
                                        <p:splitButton value="Guardar como comentario" actionListener="#{casoController.crearNota(false)}" 
                                                       update=":mainform:messages :westPanel:formint1 :inputPanel:formact :inputPanel:formCreateNota :botoneraCaso :formTopMenu"  icon="ui-icon-disk" >  
                                            <p:menuitem value="Guardar y notificar al cliente" actionListener="#{casoController.crearNota(true)}" 
                                                        update=":mainform:messages :westPanel:formint1 :inputPanel:formact :inputPanel:formCreateNota :botoneraCaso :formTopMenu"  icon="ui-icon-disk"/>  
                                            <p:menuitem value="Enviar como respuesta por correo" actionListener="#{casoController.responder()}" 
                                                        update=":mainform:messages :westPanel:formint1 :inputPanel:formact :inputPanel:formCreateNota :botoneraCaso"
                                                        icon="ui-icon-mail-closed"/>  
                                            <p:separator />  

                                            <p:menuitem value="Descartar borrador" actionListener="#{casoController.descartarBorrador()}"
                                                        update=":mainform:messages :inputPanel:formCreateNota"
                                                        icon="ui-icon-mail-closed"
                                                        rendered="#{casoController.selected.respuesta ne null}"/>

                                            <p:menuitem value="Guardar borrador" actionListener="#{casoController.guardarBorrador()}"
                                                        update=":mainform:messages :inputPanel:formCreateNota"
                                                        icon="ui-icon-disk"/>


                                        </p:splitButton>  

                                    </h:panelGrid> 

                                </h:panelGrid>  

                            </h:form>
                        </p:tab>

                        <p:tab id="tab-timeline" title="TimeLine">

                            <pe:timeline id="timeline" value="#{casoTimelineController.model}" var="audit"  
                                         editable="false" eventStyle="dot" zoomMax="#{casoTimelineController.zoomMax}"
                                         zoomMin="60000"
                                         timeZone="#{casoTimelineController.timeZone}"  
                                         showButtonNew="false" minHeight="200" widgetVar="timelineWdgt">  

                                <h:panelGrid columns="1" title="#{audit}">  
                                    <h:outputText 
                                        value="Info: #{(not empty audit.campo and not empty audit.oldValue) ? 
                                                       audit.campo.concat(' cambiÃ³ de \'').concat(audit.oldValue).concat('\' a ').concat('\'').concat(audit.newValue).concat('\'')
                                                       :audit.newValue}"/>  
                                    <h:outputText value="Realizado por: #{audit.idUser} (#{casoController.prettyDate(audit.fecha)})"/>  

                                </h:panelGrid>        
                            </pe:timeline>  


                            <p:separator/>

                            <div class="panel no-border panel-dark">
                                <div class="timeline">
                                    <!-- Timeline header -->
                                    <ui:repeat value="#{casoController.auditLogsCurrentCase}" var="audit" >

                                        <div class="tl-entry" >
                                            <div class="tl-time">
                                                <h:outputText value="#{casoController.prettyDate(audit.fecha)}"/>
                                            </div>
                                            <div class="tl-icon bg-info"><i class="fa fa-thumb-tack"></i></div>
                                            <div class="panel tl-body">
                                                #{(not empty audit.campo and not empty audit.oldValue) ? audit.campo.concat(' cambiÃ³ de ').concat(audit.oldValue).concat(' a '):''}
                                                #{audit.newValue}

                                                <i class="text-muted text-sm">                                              
                                                    <h:outputText value=" Realizado por: #{audit.idUser} "/>
                                                    <h:outputText value="#{audit.fecha}">
                                                        <f:convertDateTime pattern="#{bundle.dateFormat2}" />
                                                    </h:outputText>  
                                                </i>
                                            </div> <!-- / .tl-body -->
                                        </div> <!-- / .tl-entry -->

                                        <p:separator/>

                                    </ui:repeat>
                                </div> <!-- / .timeline -->
                            </div>



                        </p:tab>  

                        <p:tab id="tabAgendarEvento" title="Agenda">

                            <h:form id="formAgendarEvento">
                                <h2>Calendario de Eventos</h2>

                                <p:schedule id="myschedule" value="#{casoScheduleController.lazyScheduleEventsModel}" 
                                            aspectRatio="4"
                                            firstHour="8" widgetVar="myschedule" >
                                    <p:ajax event="dateSelect" listener="#{casoScheduleController.onDateSelect}"  
                                            disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                            update=":createEventForm:eventDetails" oncomplete="PF('createEventDialog').show();PF('viewEventDialog').hide()" />  

                                    <p:ajax event="eventSelect" listener="#{casoScheduleController.onEventSelect}" 
                                            disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                            update=":viewEventForm :viewEventForm:panelClientesInvitados:panelclientesinvitados" oncomplete="PF('viewEventDialog').show();PF('createEventDialog').hide();" />  

                                    <p:ajax event="eventMove" listener="#{casoScheduleController.onEventMove}" 
                                            disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                            update=":inputPanel:formTimelineAgenda :mainform:messages" />  
                                    <p:ajax event="eventResize" listener="#{casoScheduleController.onEventResize}" 
                                            disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                            update=":inputPanel:formTimelineAgenda :mainform:messages" /> 
                                </p:schedule>
                            </h:form>

                            <p:separator/>

                            <h:form id="formTimelineAgenda">

                                <h2>Cronograma de Eventos</h2>

                                <pe:timeline id="timelineEvents" value="#{casoTimelineController.modelScheduleEvents}" var="event"  
                                             responsive="true"  timeZone="#{casoTimelineController.timeZone}" 
                                             showNavigation="true" 
                                             editable="false" eventStyle="dot"
                                             showButtonNew="false" minHeight="200" widgetVar="timelineWdgt">  

                                    <h:panelGrid columns="1">  
                                        <i class="fa fa-calendar"></i>
                                        <h:outputText value="#{event.title}"/>  
                                        <h:outputText value="Agendado por: #{event.idUsuario ne null ? event.idUsuario:''} (#{casoController.prettyDate(event.startDate)})"/>  

                                    </h:panelGrid> 


                                </pe:timeline>  
                            </h:form>
                        </p:tab>  

                        <p:tab id="tabArchivos" title="Adjuntos (#{casoController.cantidadAttachment()})">
                            <h:form id="formlistaadjuntos">
                                <p:fileUpload id="fileupload"
                                              sizeLimit="5242880"
                                              invalidSizeMessage="El archivo excede el tamaÃ±o maximo: 5MB."
                                              fileUploadListener="#{casoController.subir}"
                                              disabled="#{not casoController.verificarGrabarCaso()}"
                                              label="Subir Documentos"
                                              uploadLabel="Subir"
                                              cancelLabel="Cancelar Subida"
                                              invalidFileMessage="Archivo Invalido." 
                                              mode="advanced"
                                              dragDropSupport="true"
                                              auto="true"
                                              update=":mainform:messages listaadjuntos :inputPanel:formCreateNota"
                                              multiple="true"  
                                              rendered="#{casoController.selected.open}"/>

                                <p:tooltip for="fileupload" value="Sugerencia: Arrastre y suelte los archivos en esta Ã¡rea del caso para adjuntarlos."/>

                                <p:separator/>
                                <h:panelGroup id="listaadjuntos" layout="block">

                                    <c:forEach items="#{casoController.selected.attachmentsNotEmbedded}" var="caso_attachment" >
                                        <h:panelGrid columns="6">
                                            <p:graphicImage name="file_extension_#{caso_attachment.fileExtension}.png" library="file_extension_icons" />
                                            <p:commandLink ajax="false" value="#{caso_attachment.nombreArchivoOriginal}" 
                                                           title="Descargar #{caso_attachment.nombreArchivo} (#{caso_attachment.mimeType})">
                                                <p:fileDownload value="#{casoController.bajarArchivo(caso_attachment.idAttachment)}" />
                                            </p:commandLink>
                                            <h:outputText value="#{caso_attachment.fileSizeHuman}" style="color: #7A7A7A"/>
                                            <p:lightBox iframe="true" iframeTitle="#{caso_attachment.nombreArchivoOriginal}"
                                                        rendered="#{caso_attachment.isPdf() or caso_attachment.isImage()}"> 
                                                <h:outputLink  value="#{facesContext.externalContext.requestContextPath}/DownloadFileServlet?id=#{caso_attachment.idAttachment}" 
                                                               styleClass="ui-icon ui-icon-search"
                                                               title="Preview">  
                                                </h:outputLink>
                                            </p:lightBox>
                                            <p:commandLink  title="Eliminar #{caso_attachment.nombreArchivo} (#{caso_attachment.mimeType})"
                                                            onclick="PF('borrarAttachment').show();"
                                                            disabled="#{not casoController.verificarGrabarCaso()}">
                                                <i class="fa fa-times"></i>
                                                <f:setPropertyActionListener target="#{casoController.idFileDelete}" value="#{caso_attachment.idAttachment}"/>
                                            </p:commandLink>
                                        </h:panelGrid>
                                    </c:forEach>

                                </h:panelGroup>
                            </h:form>


                        </p:tab>

                        <p:tab id="tabCasosRelacionados" title="Casos relacionados (#{casoController.selected.casosRelacionadosList.size()})" >
                            <h:form id="formCasosRel" rendered="#{casoController.selected.casosRelacionadosList.size() gt 0}">
                                <h:panelGrid columns="1">
                                    <c:forEach items="#{casoController.selected.casosRelacionadosList}" var="item" >
                                        <h:commandLink action="#{casoController.filterByIdCaso(item.idCaso)}" >
                                            <h:outputText styleClass="ticket-status" 
                                                          style="background: \##{item.idSubEstado.backgroundColor}; color: \##{item.idSubEstado.fontColor};" value="#{item.idSubEstado.nombre}"
                                                          />
                                            <h:outputText value=" #{item.tipoCaso.nombre} NÂ°#{item.idCaso} - #{item.tema}"/>
                                        </h:commandLink>
                                        <p:separator/>
                                    </c:forEach>
                                </h:panelGrid>
                            </h:form>
                            <h:outputText value="No hay casos relacionados" rendered="#{casoController.selected.casosRelacionadosList.size() le 0}"/>
                        </p:tab>

                        <p:tab id="tabSubCasos" title="Sub casos (#{casoController.selected.casosHijosList.size()})" >
                            <h:form id="formSubCasos" rendered="#{casoController.selected.casosHijosList.size() gt 0}">
                                <h:panelGrid columns="1">
                                    <c:forEach items="#{casoController.selected.casosHijosList}" var="itemS">
                                        <h:commandLink action="#{casoController.filterByIdCaso(itemS.idCaso)}">

                                            <h:outputText styleClass="ticket-status" value="#{itemS.idEstado.nombre}"
                                                          rendered="#{not itemS.isOpen()}"
                                                          style="background: #444444; color: #FFFFFF;"/>
                                            &nbsp;
                                            <h:outputText styleClass="ticket-status" 
                                                          style="background: \##{itemS.idSubEstado.backgroundColor}; color: \##{itemS.idSubEstado.fontColor};" value="#{itemS.idSubEstado.nombre}"
                                                          />
                                            <h:outputText value=" #{itemS.tipoCaso.nombre} NÂ°#{itemS.idCaso} - #{itemS.tema}"/>
                                        </h:commandLink>
                                        <p:separator/>
                                    </c:forEach>
                                </h:panelGrid>
                            </h:form>
                            <h:outputText value="No hay sub casos" rendered="#{casoController.selected.casosHijosList.size() le 0}"/>
                        </p:tab>

                        <p:tab id="tabEditarEvento" title="Detalles del Evento" closable="true" 
                               rendered="#{casoScheduleController.event ne null}">

                            <h:form id="editEventForm">
                                <p:messages globalOnly="true"/>

                                <h:panelGrid columns="2" styleClass="filtersGrid">

                                    <p:panelGrid id="eventDetails" 
                                                 style="margin-bottom:10px;" styleClass="filtersGrid" >

                                        <p:row>
                                            <p:column>
                                                <h:outputLabel value="Evento:" style="font-weight: bold;"/>  
                                            </p:column>

                                            <p:column>
                                                <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                                             required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                                <p:watermark for="title" value="Titulo del evento"/>
                                                <p:message for="title"/>
                                            </p:column>
                                        </p:row>
                                        <p:row>

                                            <p:column>
                                                <h:outputLabel value="DescripciÃ³n:" style="font-weight: bold;"/>  
                                            </p:column>

                                            <p:column>
                                                <p:inplace editor="true">
                                                    <f:facet name="output">
                                                        <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para aÃ±adir una descripciÃ³n'}" />
                                                    </f:facet>
                                                    <f:facet name="input">
                                                        <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                                        <p:watermark for="desc" value="DescripciÃ³n del evento"/>
                                                    </f:facet>
                                                </p:inplace>

                                                <p:message for="desc"/>
                                            </p:column>
                                        </p:row>

                                        <p:row>

                                            <p:column>
                                                <h:outputLabel value="Fecha:" style="font-weight: bold;"/>  
                                            </p:column>

                                            <p:column>
                                                <p:panelGrid columns="6">

                                                    <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                                pattern="dd/MM/yyyy HH:mm"
                                                                required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                        <p:ajax event="dateSelect" update="endDate" />
                                                    </p:calendar>  
                                                    <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/>  
                                                    <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                                pattern="dd/MM/yyyy HH:mm"
                                                                required="true" requiredMessage="Favor ingrese fecha y hora de tÃ©rmino.">  
                                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                        <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                                        <f:validator validatorId="primeDateRangeValidator" />
                                                    </p:calendar>
                                                    <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                                             label="Todo el dia"/>  
                                                    <h:outputLabel for="allDay" value="Todo el dÃ­a" style="font-weight: bold;"/> 
                                                </p:panelGrid>

                                                <p:message for="from"/>
                                                <p:message for="endDate"/>
                                                <p:message for="allDay"/>


                                            </p:column>


                                        </p:row>

                                        <p:row>
                                            <p:column>
                                                <h:outputLabel for="resources" value="Recursos:" style="font-weight: bold;"/>  
                                            </p:column>

                                            <p:column>

                                                <p:panelGrid columns="2">
                                                    <p:autoComplete id="resources" value="#{casoScheduleController.selectedResourceToAddInvited}" 
                                                                    completeMethod="#{casoScheduleController.autoCompleteResource}"  
                                                                    var="rr"  itemValue="#{rr}" itemLabel="#{rr.nombre}">  

                                                        <p:ajax  event="itemSelect" process="@this" listener="#{casoScheduleController.resourceInvitedItemSelectEvent}" 
                                                                 update=":inputPanel:editEventForm:panelRecursos"  />

                                                        <f:facet name="itemtip">
                                                            <h:panelGrid  columns="2" cellpadding="5">  
                                                                <f:facet name="header">  
                                                                    <h:outputText value="#{rr.nombre}" />  
                                                                </f:facet>  

                                                                <h:outputText value="Nombre: " />  
                                                                <h:outputText value="#{rr.nombre}" />  

                                                                <h:outputText value="Tipo: " />  
                                                                <h:outputText value="#{rr.tipo}" /> 


                                                            </h:panelGrid>  
                                                        </f:facet>  

                                                    </p:autoComplete>   

                                                    <p:panel id="panelRecursos">

                                                        <h:outputText value="sin recursos" rendered="#{empty casoScheduleController.event.data.resourceList}"/>
                                                        <ui:repeat id="rList" value="#{casoScheduleController.event.data.resourceList}" var="rSelected">
                                                            <h:panelGroup styleClass="ticket-status" style="background: #4abf5a; color: #FFFFFF;"
                                                                          layout="block">
                                                                <h:outputText   value="#{rSelected.nombre}"/>
                                                                <p:commandLink value="x" update=":inputPanel:editEventForm:panelRecursos" 
                                                                               process="@this"
                                                                               style="border: none !important;"
                                                                               styleClass="btn btn-xs btn-danger btn-outline">

                                                                    <p:collector unique="true" value="#{rSelected}" 
                                                                                 removeFrom="#{casoScheduleController.event.data.resourceList}"/>
                                                                </p:commandLink>
                                                            </h:panelGroup>&nbsp;

                                                        </ui:repeat>
                                                    </p:panel>
                                                </p:panelGrid>
                                                <p:watermark for="resources" value="AÃ±adir recurso..."/>


                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column>
                                                <h:outputLabel for="recordatorios" value="Recordatorios:" style="font-weight: bold;"/>  
                                            </p:column>

                                            <p:column>
                                                <p:panel id="reminders">

                                                    <ui:repeat id="recordatorios" value="#{casoScheduleController.event.data.scheduleEventReminderList}" var="reminder" >

                                                        <h:panelGrid columns="4" cellpadding="5" cellspacing="5">

                                                            <h:selectOneMenu id="reminderType" 
                                                                             value="#{reminder.reminderType}" 
                                                                             required="true" requiredMessage="Se requiere ...">

                                                                <f:selectItem itemLabel="Correo" itemValue="EMAIL"/>
                                                                <f:selectItem itemLabel="Ventana emergente" itemValue="POPUP" itemDisabled="true"/>
                                                            </h:selectOneMenu>

                                                            <h:inputText id="quantityTime" value="#{reminder.quantityTime}" size="3" required="true" />

                                                            <h:selectOneMenu id="unitOfTimeInMinutes" 
                                                                             value="#{reminder.unitOfTimeInMinutes}" 
                                                                             required="true" requiredMessage="Se requiere ...">
                                                                <f:selectItem itemLabel="minutos" itemValue="1"/>
                                                                <f:selectItem itemLabel="horas" itemValue="60"/>
                                                                <f:selectItem itemLabel="dÃ­as" itemValue="1440"/>
                                                                <f:selectItem itemLabel="semanas" itemValue="10080"/>
                                                            </h:selectOneMenu>

                                                            <p:commandLink value="eliminar" update=":inputPanel:editEventForm:eventDetails" immediate="true"
                                                                           style="color: #006dcc"
                                                                           actionListener="#{casoScheduleController.removeScheduleEventReminder(reminder)}" >

                                                            </p:commandLink>

                                                        </h:panelGrid>


                                                    </ui:repeat>
                                                    <p:commandLink value="Agregar recordatorio" style="color: #006dcc"
                                                                   actionListener="#{casoScheduleController.addNewScheduleEventReminder()}" 
                                                                   immediate="true"
                                                                   update=":inputPanel:editEventForm:reminders"/>
                                                </p:panel>

                                            </p:column>
                                        </p:row>


                                        <p:row>
                                            <p:column>

                                            </p:column>

                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <h:selectBooleanCheckbox id="publicEventCheckbox" value="#{casoScheduleController.event.data.publicEvent}">
                                                        <p:ajax update=":inputPanel:editEventForm:publicEvent" process="@this"/>  
                                                    </h:selectBooleanCheckbox>
                                                    <h:outputLabel for="publicEventCheckbox" value="Clientes pueden inscribirse al evento" 
                                                                   title="Clientes pueden inscribirse al evento"/>  
                                                </h:panelGrid>

                                                <p:message for="publicEventCheckbox"/>

                                                <p:panel id="publicEvent" visible="#{casoScheduleController.event.data.publicEvent}">
                                                    <p:panelGrid rendered="#{casoScheduleController.event.data.publicEvent}">
                                                        <p:row>
                                                            <p:column>
                                                                <h:outputLabel value="MÃ¡x Inscritos" for="maxClientesInscritos" style="font-weight: bold;"/>
                                                            </p:column>

                                                            <p:column>
                                                                <p:inputText id="maxClientesInscritos" 
                                                                             value="#{casoScheduleController.event.data.maxClientesInscritos}" 
                                                                             required="true" requiredMessage="Se requiere que ingrese el mÃ¡ximo de Clientes Inscritos.">
                                                                </p:inputText>
                                                                <br/>
                                                                <h:outputFormat value="PodrÃ¡n inscribirse sÃ³lo aquellos clientes que sean {0} de {1} de {2} {3} {4}">
                                                                    <f:param value="Propietarios" />
                                                                    <f:param value="#{casoController.selected.idSubComponente ne null ? casoController.selected.idSubComponente.nombre:'cualquier '.concat(applicationBean.productSubComponentDescription)}" />
                                                                    <f:param value="#{casoController.selected.idModelo ne null ? 'modelo '.concat(casoController.selected.idModelo.nombre):'cualquier modelo'}" />
                                                                    <f:param value="#{casoController.selected.idComponente ne null ? ''.concat(applicationBean.productComponentDescription).concat(': ').concat(casoController.selected.idComponente.nombre):'cualquier '.concat(applicationBean.productComponentDescription)}" />
                                                                    <f:param value="#{casoController.selected.idProducto ne null ? ''.concat(applicationBean.productDescription).concat(': ').concat(casoController.selected.idProducto.nombre):'cualquier '.concat(applicationBean.productDescription)}" />

                                                                </h:outputFormat>
                                                                <p:message for="maxClientesInscritos"/>
                                                            </p:column>
                                                        </p:row>
                                                    </p:panelGrid>
                                                </p:panel>
                                            </p:column>
                                        </p:row>


                                        <p:row>
                                            <p:column>

                                            </p:column>

                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <h:selectBooleanCheckbox id="accionAutomaticaBool" value="#{casoScheduleController.event.data.executeAction}">
                                                        <p:ajax update=":inputPanel:editEventForm:action" process="@this"/>  
                                                    </h:selectBooleanCheckbox>
                                                    <h:outputLabel for="accionAutomaticaBool" value="Programar una acciÃ³n automÃ¡tica" 
                                                                   title="Programar una tarea o acciÃ³n que se ejecutarÃ¡ automÃ¡ticamente cuando se cumpla la fecha del evento..."/>  
                                                </h:panelGrid>

                                                <p:message for="accionAutomaticaBool"/>

                                                <p:panel id="action" visible="#{casoScheduleController.event.data.executeAction}">
                                                    <p:panelGrid rendered="#{casoScheduleController.event.data.executeAction}">
                                                        <p:row>
                                                            <p:column>
                                                                <h:outputLabel id="labelTipoAccion" value="AcciÃ³n:" for="idTipoAccion" style="font-weight: bold;"/>
                                                            </p:column>

                                                            <p:column>
                                                                <h:selectOneMenu id="idTipoAccion" styleClass="form-control"
                                                                                 value="#{casoScheduleController.event.data.idTipoAccion}" 
                                                                                 required="true" requiredMessage="Se requiere que seleccione el nombre de una clase que implemente la Accion."
                                                                                 >
                                                                    <p:ajax update=":inputPanel:editEventForm:action" />
                                                                    <f:selectItems value="#{nombreAccionController.itemsAvailableSelectOneImplementingActionClass}"/>
                                                                </h:selectOneMenu>
                                                                <p:message for="idTipoAccion"/>
                                                            </p:column>
                                                        </p:row>




                                                        <p:row rendered="#{casoScheduleController.event.data.executeAction}">
                                                            <p:column>
                                                                <h:outputLabel id="labelidAccionCustom" value="Propiedades:" for="idAccionCustom" style="font-weight: bold;" />
                                                            </p:column>

                                                            <p:column>
                                                                <p:inputTextarea id="idAccionCustom" value="#{casoScheduleController.event.data.parametrosAccion}"  style="width: 100%;"
                                                                                 title="#{bundle.CreateAccionLabel_parametros}"/>
                                                                <p:message for="idAccionCustom"/>
                                                            </p:column>
                                                        </p:row>

                                                    </p:panelGrid>
                                                </p:panel>
                                            </p:column>
                                        </p:row>





                                    </p:panelGrid> 
                                    <h:panelGroup>

                                        <p:panelGrid>
                                            <p:row>
                                                <p:column>
                                                    <h:outputLabel for="panelUsuariosInvitados" value="Usuarios Invitados:" style="font-weight: bold;"/>
                                                    <go:panelUsuariosInvitados id="panelUsuariosInvitados"/>
                                                </p:column>
                                            </p:row>

                                        </p:panelGrid>

                                        <p:panelGrid>

                                            <p:row>


                                                <p:column>
                                                    <h:outputLabel for="panelClientesInvitados2" value="Clientes Invitados (inscritos)" style="font-weight: bold;"/>
                                                    <go:panelClientesInvitados id="panelClientesInvitados2"/>
                                                </p:column>
                                            </p:row>

                                        </p:panelGrid>

                                    </h:panelGroup>  



                                </h:panelGrid>
                                <p:separator/>

                                <p:commandButton id="addButton" value="Guardar Evento" style="float: right;"
                                                 actionListener="#{casoScheduleController.saveEvent()}" 
                                                 update=":inputPanel"/>  
                                <br/>
                            </h:form>

                        </p:tab>

                    </p:tabView> 


                </pe:layoutPane>




            </pe:layoutPane>





        </ui:define>


        <ui:define name="dialogs">


            <p:confirmDialog closeOnEscape="true" global="true" showEffect="fade" hideEffect="explode" >
                <p:commandButton value="Si" type="button" styleClass="btn btn-danger ui-confirmdialog-yes" icon="ui-icon-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/> 	
            </p:confirmDialog>

            <p:dialog header="Asignarme el Caso" widgetVar="tomarCaso" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:outputLabel value="Â¿EstÃ¡ seguro de auto-asignarse el Caso y todos sus Sub-Casos?" /><br></br>
                    <div style="text-align: right">
                        <p:commandButton value="Si"
                                         actionListener="#{casoController.tomarCaso}" ajax="false" />
                        <p:commandButton value="No" onclick="PF('tomarCaso').hide()" type="button" />
                    </div>
                </h:form>
            </p:dialog>

            <p:dialog header="Datos Cliente" widgetVar="dialogClient" modal="true" dynamic="true"  closeOnEscape="true" closable="false">
                <h:form id="formDatosCliente">
                    <p:messages globalOnly="true"/>

                    <h:panelGrid id="datosDelCliente" columns="3">
                        <p:outputLabel value="Email:" for="email" style="font-weight:bold"/>
                        <h:outputText id="email" value="#{casoController.selected.emailCliente.emailCliente}"/>
                        <p:message display="both" for="email"/>
                        <p:outputLabel value="#{bundle.CreateClienteLabel_rut}" for="rut" style="font-weight:bold"/>                        
                        <p:inputText id="rut" value="#{casoController.selected.emailCliente.cliente.rut}" 
                                     title="#{bundle.CreateClienteTitle_rut}" validator="#{inputValidationBean.validarRut}">

                            <p:ajax event="blur" listener="#{casoController.formateaRut()}" update="rut,datosDelCliente"/>
                        </p:inputText>

                        <p:message display="both" for="rut"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_nombres}" for="nombres" style="font-weight:bold"/>

                        <p:inputText  id="nombres" value="#{casoController.selected.emailCliente.cliente.nombres}" label="nombres" required="true" requiredMessage="Los nombres son requeridos"/>

                        <p:message display="both" for="nombres"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_apellidos}" for="apellidos" style="font-weight:bold"/>                      
                        <p:inputText  id="apellidos" value="#{casoController.selected.emailCliente.cliente.apellidos}" label="apellidos" required="true" requiredMessage="Los apellidos son requeridos"/>                        
                        <p:message display="both" for="apellidos"/>                   

                        <p:outputLabel value="TelÃ©fono:" for="fono1" style="font-weight:bold"/>                    

                        <p:inputText  id="fono1" value="#{casoController.selected.emailCliente.cliente.fono1}" label="fono1" validatorMessage="Fono no es valido">
                            <pe:keyFilter regEx="/[\d\.\+\-\(\)]/"/>
                        </p:inputText>

                        <p:message display="both" for="fono1"/>

                        <p:outputLabel value="TelÃ©fono Adicional:" for="fono2" style="font-weight:bold"/>

                        <p:inputText  id="fono2" value="#{casoController.selected.emailCliente.cliente.fono2}" label="fono2" validatorMessage="Fono no es valido">
                            <pe:keyFilter regEx="/[\d\.\+\-\(\)]/"/>
                        </p:inputText>

                        <p:message display="both" for="fono2"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_dirParticular}" for="dirParticular" style="font-weight:bold"/>

                        <p:inputTextarea id="dirParticular" autoResize="true" value="#{casoController.selected.emailCliente.cliente.dirParticular}" 
                                         title="#{bundle.CreateClienteTitle_dirParticular}" cols="40" />

                        <p:message display="both" for="dirParticular"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_dirComercial}" for="dirComercial" style="font-weight:bold"/>

                        <p:inputTextarea id="dirComercial" autoResize="true" value="#{casoController.selected.emailCliente.cliente.dirComercial}" 
                                         title="#{bundle.CreateClienteTitle_dirComercial}" cols="40"/>

                        <p:message display="both" for="dirComercial"/>

                    </h:panelGrid>
                    <p:separator/>
                    <p:commandButton action="#{casoController.mergeCliente}" disabled="#{not (casoController.verificarGrabarCaso())}"
                                     value="Guardar" ajax="true" update=":formDatosCliente" icon="ui-icon-disk"/>  
                    <p:commandButton action="#{clienteController.prepareView(casoController.selected.idCliente, '/script/caso/Edit')}"
                                     value="Ver detalle" immediate="true" ajax="false" icon="ui-icon-circle-zoomin"/> 
                    <p:commandButton action="#{clienteController.prepareList}" value="Lista de clientes" immediate="true" ajax="false" icon="ui-icon-folder-open"/>          
                    <p:commandButton value="Cerrar" onclick="PF('dialogClient').hide()" icon="ui-icon-close" type="button"/>
                </h:form>
            </p:dialog>

            <p:dialog header="Confirmar Borrar Archivo" widgetVar="borrarAttachment" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <label id="textoEliminar" >Â¿Esta seguro de borrar el archivo?</label><br></br>
                    <br></br>
                    <div style="text-align: right">                       
                        <p:commandButton value="Si" update=":mainform:messages :inputPanel:formlistaadjuntos:listaadjuntos :inputPanel:formCreateNota"
                                         actionListener="#{casoController.deleteAttachment(actionEvent)}" onclick="PF('borrarAttachment').hide()"/>

                        <p:commandButton value="No" onclick="PF('borrarAttachment').hide()" type="button" />
                    </div>
                </h:form>
            </p:dialog>



            <p:dialog header="Editar Comentario" widgetVar="Nota" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formEditNota">
                    <p:messages globalOnly="true"/>


                    <h:panelGrid columns="3">                     

                        <p:outputLabel for="textoNotaVisibilidadPublica" value="PÃºblico:" style="font-weight:bold"/>
                        <p:selectBooleanCheckbox id="textoNotaVisibilidadPublica" value="#{casoController.selectedNota.visible}" />
                        <p:message for="textoNotaVisibilidadPublica"/>

                        <p:outputLabel for="nextResponseDue1" value="#{bundle.cambiarSLA}:" style="font-weight:bold"/>
                        <p:calendar locale="es" navigator="true" id="nextResponseDue1" showButtonPanel="true" mindate="#{applicationBean.now}" 
                                    value="#{casoController.selected.nextResponseDue}" 
                                    title="Next Follow Up Due" pattern="dd/MM/yyyy HH:mm" label="SLA:"/>
                        <p:message for="nextResponseDue1"/>

                        <p:outputLabel value="#{bundle.cambiarSubEstado}:" for="idSubEstadox" style="font-weight:bold"/>
                        <p:selectOneMenu rendered="#{!casoController.selected.closed}" id="idSubEstadox" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}"/>
                        </p:selectOneMenu>

                        <p:selectOneMenu rendered="#{casoController.selected.closed}" id="idSubEstado2" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoCerrado}"/>
                        </p:selectOneMenu>
                        <p:message for="idSubEstadox"/>


                    </h:panelGrid>
                    <pe:ckEditor value="#{casoController.selectedNota.texto}" required="true" language="es"
                                 toolbar="#{applicationBean.ckEditorToolbar}"
                                 id="textonota" width="560" height="210"/>

                    <p:commandButton value="Guardar" ajax="false" update=":westPanel:formint1 :formCreateNota :inputPanel:formlistaadjuntos" actionListener="#{casoController.editNota(false)}"/>
                    <p:commandButton value="Guardar y notificar al cliente" ajax="false" update=":westPanel:formint1 :formCreateNota :inputPanel:formlistaadjuntos" actionListener="#{casoController.editNota(true)}"/>
                    <p:commandButton value="Cerrar" ajax="true"  onclick="PF('Nota').hide()"  update=":westPanel:formint1" />


                </h:form>
            </p:dialog>

            <p:dialog header="Cerrar Caso" widgetVar="closeCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formCerrarCaso">

                    <p:messages/>

                    <h:panelGrid columns="3">

                        <p:outputLabel value="Tipo:" style="font-weight:bold" rendered="#{casoController.selected.tipoCaso eq null}"/>
                        <p:selectOneMenu id="idTipoCaso" rendered="#{casoController.selected.tipoCaso eq null}" converter="TipoCasoControllerConverter"
                                         required="true" requiredMessage="El tipo de caso es requerido."
                                         filter="true" filterMatchMode="contains"
                                         value="#{casoController.selected.tipoCaso}" >                                  
                            <f:selectItems value="#{applicationBean.tipoCasoAvailableList}" var="tipo" 
                                           itemLabel="#{tipo.nombre}" itemValue="#{tipo.idTipoCaso}" itemDescription="#{tipo.descripcion}"/>
                            <p:ajax update="idSubEstado2"/>
                        </p:selectOneMenu>
                        <p:message for="idTipoCaso"/>

                        <p:outputLabel for="idSubEstado2"  value="Seleccione causal de cierre del caso:" style="font-weight: bold;"/>
                        <p:selectOneMenu id="idSubEstado2" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoCerrado}" var="subEstad" itemDescription="#{subEstad.description}"/>
                        </p:selectOneMenu>
                        <p:message for="idSubEstado2" />                            

                    </h:panelGrid>

                    <p:outputLabel value="Nota: se cerrarÃ¡n tambiÃ©n los sub-casos (casos hijos del caso actual), si existen."
                                   rendered="#{casoController.selected.tipoCaso ne EnumTipoCaso.ENTREGA.getTipoCaso()}"/>
                    <p:outputLabel value="Nota: Todos los subcasos deben estar previamente cerrados."
                                   rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}"/>

                    <h:panelGrid columns="3">

                        <p:commandButton value="Cancelar" ajax="true"  onclick="PF('closeCase').hide()"   />

                        <p:commandButton value="Cerrar el caso" ajax="true" update="formCerrarCaso :mainform:messages"
                                         actionListener="#{casoController.cerrarCaso}"   />

                        <p:commandButton value="Cerrar el caso y programar visita preventiva" 
                                         rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}"
                                         ajax="true" update=":formCerrarCaso :mainform:messages"
                                         actionListener="#{casoController.cerrarCasoYProgramarVP}"   />
                    </h:panelGrid>

                </h:form>
            </p:dialog>

            <p:dialog header="Eliminar Caso" widgetVar="destroyCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formEliminarCaso">
                    <h:outputLabel value="#{bundle.EliminarCaso}" />
                    <br/><br/>
                    <p:commandButton rendered="#{casoController.verificarEliminarCaso()}"
                                     ajax="false" value="Eliminar Caso" action="#{casoController.destroy()}"/>
                    <p:commandButton value="Cancelar" ajax="true"  onclick="PF('destroyCase').hide()"   />
                </h:form>
            </p:dialog>

            <p:dialog header="ReAbrir Caso" widgetVar="openCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:outputLabel value="#{bundle.ReabrirCaso}" />

                    <br>
                        <p:outputLabel value="#{bundle.EditCasoLabel_idSubEstado}" for="idSubEstadoreopen" style="font-weight:bold"/>
                        <p:selectOneMenu id="idSubEstadoreopen"  
                                         filter="true" filterMatchMode="contains"
                                         value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}" var="subEstad" itemDescription="#{subEstad.description}"/>

                        </p:selectOneMenu>
                    </br>

                    <p:commandButton value="Aceptar" ajax="false" update=":mainform:messages"
                                     actionListener="#{casoController.reabrirCaso}"   />
                    <p:commandButton value="Cancelar" ajax="true"  onclick="PF('openCase').hide()"   />
                </h:form>
            </p:dialog>

            <p:dialog header="Agregar Casos Relacionado" widgetVar="casosRela" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Id Caso relacionado:" for="idcasorel" style="font-weight: bold"/>
                        <h:inputText value="${casoController.idCaserel}" id="idcasorel"/>
                        <p:commandButton value="Agregar" ajax="true" update=":mainform:messages idcasorel"
                                         actionListener="#{casoController.agregarRelacionado}"   />
                        <p:button value="Salir" onclick="PF('casosRela').hide()"   />
                    </h:panelGrid>
                </h:form>
            </p:dialog>

            <p:dialog id="idDialogArbolItem" header="Seleccione Item" widgetVar="idDialogArbolItem" dynamic="true" rendered="#{casoController.casoTipoReparacion}"
                      modal="true" height="550" closeOnEscape="true" closable="false">
                <h:form id="formArbolItem">
                    <div align="left">
                        <p:tree id="arbol" value="#{itemController.tree}" var="node" dynamic="true" cache="false"
                                selectionMode="single" selection="#{itemController.item}"
                                style="border-color: window;">
                            <p:ajax event="select" listener="#{casoController.onNodeItemSelectedInSelectedCaso}" 
                                    update=":inputPanel:formDesc" oncomplete="PF('idDialogArbolItem').hide()"/>
                            <p:treeNode expandedIcon="myfoldericon16" collapsedIcon="myfoldericon16">
                                <h:outputText value="#{node.nombre}" />
                            </p:treeNode>
                        </p:tree>
                    </div>
                </h:form>
            </p:dialog>

            <p:dialog header="Transferir Caso" widgetVar="transferir" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="transferForm">

                    <p:panel id="panel-transferir">

                        <p:messages />

                        <!-- enable focus component -->
                        <p:focus context="panel-transferir" />

                        <p:panelGrid style="margin-bottom:10px;" styleClass="filtersGrid">
                            <p:row>

                                <p:column colspan="2">
                                    <p:outputPanel id="tipoTransferPanel">  
                                        <p:selectOneRadio id="tipoTransfer" value="#{casoController.tipoTransferOption}" layout="custom">  
                                            <f:selectItem itemLabel="A otro Agente" itemValue="1" />  
                                            <f:selectItem itemLabel="A otro Cliente" itemValue="2" />                          
                                            <p:ajax update=":transferForm:tipoTransferPanel" listener="#{vistaController.handleAnyChangeEvent()}" /> 
                                        </p:selectOneRadio>  



                                        <h:panelGrid>

                                            <h:panelGrid columns="3">
                                                <p:radioButton id="idAgente" for="tipoTransfer" itemIndex="0"/>  
                                                <h:outputLabel value="A otro Agente:" for="idAgente" style="font-weight: bold"/>
                                                <p:selectOneMenu id="owner1" value="#{casoController.usuarioSeleccionadoTransfer}" filter="true" filterMatchMode="contains"
                                                                 required="true" requiredMessage="Debe Seleccionar un agente si desea transferir el caso."
                                                                 rendered="#{casoController.tipoTransferOption eq 1}">

                                                    <f:selectItems value="#{usuarioController.itemsAvailableSelectOneNoSystem}"/>
                                                </p:selectOneMenu>

                                            </h:panelGrid>

                                            <h:panelGrid columns="3">
                                                <p:radioButton id="idCliente" for="tipoTransfer" itemIndex="1"/>  
                                                <h:outputLabel value="A otro Cliente:" for="idCliente" style="font-weight: bold"/>
                                                <p:autoComplete value="#{casoController.emailClienteSeleccionadoTransfer}"
                                                                completeMethod="#{emailClienteController.completeEmailCliente}"  
                                                                var="email" itemValue="#{email}" itemLabel="#{email.emailCliente}"
                                                                required="true" requiredMessage="Debe Seleccionar un cliente si desea transferir el caso."
                                                                rendered="#{casoController.tipoTransferOption eq 2}">  

                                                    <f:facet name="itemtip">  
                                                        <h:panelGrid  columns="2" cellpadding="5">  
                                                            <f:facet name="header">  
                                                                <h:outputText value="#{email.emailCliente}" />  
                                                            </f:facet>  

                                                            <h:outputText value="Nombre: " />  
                                                            <h:outputText value="#{email.cliente.nombres}" />  

                                                            <h:outputText value="Apellidos: " />  
                                                            <h:outputText value="#{email.cliente.apellidos}" /> 

                                                            <h:outputText value="Rut: " />  
                                                            <h:outputText value="#{email.cliente.rut}" /> 
                                                        </h:panelGrid>  
                                                    </f:facet>  

                                                </p:autoComplete>               



                                            </h:panelGrid>


                                        </h:panelGrid>  
                                    </p:outputPanel>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">
                                    <h:outputLabel value="Motivo de transferencia: " for="owner1"  style="font-weight: bold"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">
                                    <p:inputTextarea id="transferNote" value="#{casoController.textoNota}" style="width: 100%;" required="true" requiredMessage="El Motivo de la transferencia o asignaciÃ³n es requerido."/>                              
                                </p:column>
                            </p:row>

                        </p:panelGrid>

                        <f:facet name="footer">
                            <p:commandButton value="Transferir" update=":transferForm :inputPanel:formact :westPanel:formint1" actionListener="#{casoController.asignarCaso}"  />
                            <p:commandButton value="Cerrar" onclick="PF('transferir').hide()" type="button" /> 
                        </f:facet>
                    </p:panel>



                </h:form>
            </p:dialog>


            <p:dialog id="createEventDialog" widgetVar="createEventDialog" header="Crear Evento" dynamic="true"
                      showEffect="fade" hideEffect="fade" closeOnEscape="true" closable="false">  
                <h:form id="createEventForm">

                    <p:panelGrid id="eventDetails" columns="1" 
                                 style="margin-bottom:10px;" styleClass="filtersGrid" >

                        <p:messages globalOnly="true"/>

                        <p:row>
                            <p:column>
                                <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                             required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                <p:watermark for="title" value="Titulo del evento"/>
                                <p:message for="title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para aÃ±adir una descripciÃ³n'}" />
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                        <p:watermark for="desc" value="DescripciÃ³n del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="desc"/>
                            </p:column>
                        </p:row>
                        <p:separator/>
                        <p:row>

                            <p:column>
                                <h:outputLabel value="Fecha:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:panelGrid columns="6">
                                    <h:outputLabel for="from" value="Desde:" style="font-weight: bold;"/>  
                                    <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                pattern="dd/MM/yyyy HH:mm"
                                                required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                        <p:ajax event="dateSelect" update="endDate" />
                                    </p:calendar>  
                                    <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/>  
                                    <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                pattern="dd/MM/yyyy HH:mm"
                                                required="true" requiredMessage="Favor ingrese fecha y hora de tÃ©rmino.">  
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                        <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                        <f:validator validatorId="primeDateRangeValidator" />
                                    </p:calendar>
                                    <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                             label="Todo el dia"/>  
                                    <h:outputLabel for="allDay" value="Todo el dÃ­a" style="font-weight: bold;"/> 
                                </p:panelGrid>

                                <p:message for="from"/>
                                <p:message for="endDate"/>
                                <p:message for="allDay"/>


                            </p:column>


                        </p:row>

                        <p:separator/>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="Organizador:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{casoScheduleController.event.data.idUsuario.capitalName}"/>
                            </p:column>
                        </p:row>

                    </p:panelGrid>  

                    <p:separator/>
                    <p:commandButton value="Cerrar" oncomplete="PF('createEventDialog').hide();" update=":createEventForm:eventDetails" process="@this">
                        <p:resetInput target="@form" />
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton id="addButton" value="Crear Evento" 
                                     actionListener="#{casoScheduleController.addEvent()}"
                                     update=":createEventForm:eventDetails" />  

                    &nbsp;
                    <p:commandLink id="editButton" value="Editar evento Â»" 
                                   style="font-weight: bold;float: right;color: #15c;text-decoration: underline;cursor: pointer;white-space: nowrap;"
                                   actionListener="#{casoScheduleController.goEditEvent()}" update=":createEventForm:eventDetails"/>
                </h:form>
            </p:dialog>

            <p:dialog id="viewEventDialog" widgetVar="viewEventDialog" header="Evento" dynamic="true"
                      showEffect="fade" hideEffect="fade" closeOnEscape="true" closable="true" modal="true">  
                <h:form id="viewEventForm">

                    <p:messages globalOnly="true"/>


                    <p:panelGrid columns="1" styleClass="filtersGrid">

                        <p:row>
                            <p:column colspan="2">
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <p:outputLabel value="#{casoScheduleController.event.title}" title="#{casoScheduleController.event.data.eventId}" style="font-weight: bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                                     required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                        <p:watermark for="title" value="Titulo del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="title"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column colspan="2">
                                <p:panelGrid columns="6">

                                    <p:inplace editor="true">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.formatDateRange(casoScheduleController.event.startDate, casoScheduleController.event.endDate)}" />
                                            <h:outputText value="#{casoScheduleController.event.allDay eq true ? ' Todo el dia':''}" />
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <p:ajax event="dateSelect" update="endDate" />
                                            </p:calendar>  
                                            <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/> 
                                            <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de tÃ©rmino.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                                <f:validator validatorId="primeDateRangeValidator" />
                                            </p:calendar>

                                            <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                                     label="Todo el dia"/>  
                                            <h:outputLabel for="allDay" value="Todo el dÃ­a" style="font-weight: bold;"/> 
                                        </f:facet>
                                    </p:inplace>

                                </p:panelGrid>

                                <p:message for="from"/>
                                <p:message for="endDate"/>
                                <p:message for="allDay"/>

                            </p:column>


                        </p:row>

                        <p:row>
                            <p:column colspan="2">
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para aÃ±adir una descripciÃ³n'}" />
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                        <p:watermark for="desc" value="DescripciÃ³n del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="desc"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="Organizador:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{casoScheduleController.event.data.idUsuario.capitalName}"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:panelGrid columns="2" styleClass="filtersGrid" >

                                    <p:panelGrid columns="1" rendered="#{not empty casoScheduleController.event.data.usuariosInvitedList}"
                                                 style="margin-bottom:10px;" styleClass="filtersGrid" >
                                        <p:row>
                                            <p:column>
                                                <div class="formSeparator">
                                                    <h2>Usuarios Invitados</h2>
                                                </div>  
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column>
                                                <go:panelUsuariosInvitados id="panelUsuariosInvitados"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                    <p:panelGrid columns="1" rendered="#{not empty casoScheduleController.event.data.scheduleEventClientList}"
                                                 style="margin-bottom:10px;" styleClass="filtersGrid" >
                                        <p:row>
                                            <p:column>
                                                <div class="formSeparator">
                                                    <h2>Clientes Invitados/inscritos</h2>
                                                </div>  
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column>
                                                <go:panelClientesInvitados id="panelClientesInvitados"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                </p:panelGrid>
                            </p:column>
                        </p:row>


                    </p:panelGrid>

                    <p:separator/>

                    <p:commandButton id="delButton" value="Eliminar evento" styleClass="btn btn-danger"
                                     actionListener="#{casoScheduleController.deleteSelectedEvent()}">
                        <p:confirm header="ConfirmaciÃ³n" message="Esta seguro de eliminar el evento ?" icon="ui-icon-alert"/>
                    </p:commandButton>

                    &nbsp;
                    <p:commandButton value="Cerrar" oncomplete="PF('viewEventDialog').hide();" update=":viewEventForm" process="@this">
                        <p:resetInput target="@form" />
                    </p:commandButton>


                    &nbsp;

                    <p:commandButton id="addButton" value="Guardar"
                                     actionListener="#{casoScheduleController.quickSaveEvent()}"
                                     update=":viewEventForm" />
                    &nbsp;
                    <p:commandLink id="editButton" value="Editar evento Â»" style="font-weight: bold;float: right;color: #15c;text-decoration: underline;cursor: pointer;white-space: nowrap;"
                                   actionListener="#{casoScheduleController.goEditEvent()}" update=":inputPanel"/>
                </h:form>
            </p:dialog>


        </ui:define>
    </ui:composition>

</html>
