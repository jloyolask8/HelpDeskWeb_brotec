<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:go="http://java.sun.com/jsf/composite/go">
    <ui:composition template="/script/template_inbox.xhtml">
        <ui:define name="title">
            <p:outputLabel value="#{casoController.selected.tipoCaso ne null ? casoController.selected.tipoCaso.nombre:'Caso' } N°#{casoController.selected.idCaso}"/>
        </ui:define>

        <ui:define name="menutitle">
            <p:outputLabel value="Datos del Caso"/>
        </ui:define>

        <ui:define name="head">
            <style type="text/css">
                .ui-autocomplete-multiple-container{
                    width: 100% !important;
                }
                .ui-panelgrid-odd{
                    //background: none repeat scroll 0 0 #F2F5F9;
                }

                .ui-panelgrid-even{
                    //background: none repeat scroll 0 0 #F2F5F9;
                }

                .filtersGridParaOtroEmail td:nth-child(1) {
                    width: 70px;
                    padding-left: 0px;
                }
                .filtersGridParaOtroEmail td:nth-child(2) {
                    padding-right: 0px;
                    margin-right: 100px;

                }

                .ui-panel .ui-panel-content {
                    //border: 0px;
                    padding: 0px !important;
                }

                #menucc_button{
                    background: transparent !important;
                }

                .ui-layout-pane-center{
                    /*border: none !important;*/
                    //padding-top: 0px !important;
                    //padding-left: 1px !important;
                    //margin-top: -5px !important;
                }

            </style>

        </ui:define>


        <ui:define name="west">

            <ui:include src="propertiesCaso.xhtml"/>

        </ui:define>

        <ui:define name="body">
            <pe:importEnum type="com.itcs.helpdesk.persistence.entityenums.EnumTipoAlerta" var="EnumTipoAlerta" allSuffix="ALL_ENUM_VALUES" />
            <pe:importEnum type="com.itcs.helpdesk.persistence.entityenums.EnumTipoCaso" var="EnumTipoCaso" allSuffix="ALL_ENUM_VALUES" />




            <h:form id="botoneraCaso" style="margin-top: 5px;">

                <h:panelGroup id="tituloCaso">

                    <p:panelGrid styleClass="filtersGrid" id="panelGridDatos">
                        <p:row>

                            <p:column>
                                <h:commandLink id="prio" disabled="#{casoController.selected.closed}" >
                                    <p:graphicImage library="images" name="#{casoController.selected.esPrioritario ? 'star-enabled.png':'star-disabled.png'}" title="Importante!"/>
                                    <p:ajax id="aj2" listener="#{casoController.changePriority(casoController.selected, casoController.selected.esPrioritario)}" update="prio :formTopMenu"/>

                                </h:commandLink>
                            </p:column>

                            <p:column>
                                <p:inplace editor="true" disabled="#{casoController.selected.closed}">
                                    <f:facet name="output">
                                        <p:outputLabel style="font-size: 18px !important;"
                                                       value="#{casoController.selected.tema}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText id="ticketTema" value="#{casoController.selected.tema}"/> 
                                        <p:watermark for="ticketTema" value="Asunto del caso"/>
                                    </f:facet>
                                </p:inplace>
                            </p:column>



                            <p:column>
                                <h:outputText styleClass="ticket-status" value="#{casoController.selected.idEstado.nombre}"
                                              style="#{casoController.selected.isOpen() eq true ? 'background: #4abf5a; color: #FFFFFF;':'background: #444444; color: #FFFFFF;'}"/>
                            </p:column>
                            <!-- Ticket Alert status -->
                            <p:column>
                                <h:outputText id="idSubEstado" styleClass="ticket-status" 
                                              style="background: \##{casoController.selected.idSubEstado.backgroundColor}; color: \##{casoController.selected.idSubEstado.fontColor};" 
                                              value="#{casoController.selected.idSubEstado.nombre}"/>
                            </p:column>

                            <p:column>
                                <h:panelGroup rendered="#{casoController.selected.hasScheduledEvents}">
                                    <i class="fa fa-calendar"></i>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{casoController.selected.hasAttachments}">
                                    <i class="fa fa-paperclip"></i>    
                                </h:panelGroup>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                </h:panelGroup>

                <h:panelGrid columns="14">     

                    <p:commandButton ajax="false" title="#{casoController.selected.idCasoPadre ne null ? 'Subir al caso '.concat(casoController.selected.idCasoPadre):'Ir al listado de casos'}" icon="fa fa-chevron-left" action="#{casoController.goOneLevelUp()}" style="width: 50px;"/>

                    <p:commandButton ajax="false" title="Actualizar" icon="fa fa-refresh" actionListener="#{casoController.refreshCurrentCaso()}" style="width: 50px;"/>

                    <p:commandButton ajax="false" icon="fa fa-download" value="Acta Pre-entrega" 
                                     rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}">
                        <p:fileDownload value="#{casoController.generarActaPreEntrega()}" />
                    </p:commandButton>

                    <p:menuButton id="panelBotonesResp" value="Opciones">
                        <p:menuitem  rendered="#{casoController.verificarTomarCaso()}" ajax="true" value="Asignármelo" onclick="PF('tomarCaso').show()" icon="fa fa-inbox" />
                        <p:menuitem  rendered="#{casoController.verificarTransferirCaso()}" icon="fa fa-user"
                                     ajax="true" value="Transferir" onclick="PF('transferir').show();" />
                        <p:menuitem  rendered="#{casoController.verificarAsignarCaso()}" icon="fa fa-user"
                                     ajax="true" value="Asignar" onclick="PF('transferir').show();" />
                        <p:menuitem  rendered="#{casoController.verificarCerrarCaso()}" icon="fa fa-lock"
                                     ajax="true" value="Cerrar el caso"  onclick="PF('closeCase').show();" />
                        <p:menuitem  rendered="#{casoController.verificarReabrirCaso()}" ajax="true" value="Reabrir Caso"  icon="fa fa-unlock" 
                                     onclick="PF('openCase').show();" />
                        <p:separator/>
                        <p:menuitem rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.PREVENTIVO.getTipoCaso()}"
                                    value="Generar Documento Visita Preventiva" 
                                    title="Generar Documento Visita Preventiva"                                                 
                                    actionListener="#{casoController.generarPDFVisitaPreventivaPostventa()}"
                                    icon="fa fa-file"  />
                        <p:separator rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.PREVENTIVO.getTipoCaso()}"/>
                        <p:menuitem ajax="false" value="Copiar" action="#{casoController.prepareCopy()}" icon="fa fa-copy"/>

                        <p:menuitem ajax="false" value="Copiar y Asignármelo" action="#{casoController.prepareCopyAndAssignMe()}" icon="fa fa-clipboard"/>


                        <p:menuitem rendered="#{casoController.verificarCrearColaborativo()}" icon="fa fa-code-fork"
                                    ajax="false" value="Crear Caso Colaborativo" action="#{casoController.crearCasoColab(casoController.selected)}"/>

                        <p:menuitem rendered="#{casoController.verificarRelacionarCaso()}" icon="fa fa-chain"
                                    ajax="true" value="Relacionar a Otro Caso" onclick="PF('casosRela').show();"/>



                        <p:menuitem rendered="#{casoController.verificarEliminarCaso()}" icon="fa fa-trash-o"
                                    ajax="true" value="Eliminar" onclick="PF('destroyCase').show();"/>
                    </p:menuButton>


                    <p:commandButton icon="ui-icon ui-icon-seek-prev" ajax="false"
                                     action="#{casoController.prepareEditPreviusItem()}" 
                                     title="Ir al caso anterior"
                                     disabled="#{casoController.selectedItemIndex eq casoController.pagination.pageFirstItem}"
                                     rendered="#{casoController.pagination.itemsCount > 0}"/>



                    <p:commandButton icon="ui-icon ui-icon-seek-next" ajax="false"
                                     action="#{casoController.prepareEditNextItem()}" 
                                     title="Ir al caso siguiente #{casoController.selectedItemIndex} eq #{casoController.pagination.pageLastItem}"
                                     disabled="#{casoController.selectedItemIndex eq casoController.pagination.pageLastItem}"
                                     rendered="#{casoController.pagination.itemsCount > 0}"/>
                </h:panelGrid>

            </h:form>


            <p:tabView id="inputPanel" dynamic="false" scrollable="true" cache="true" style="width: 99% !important; " activeIndex="#{casoController.activeIndexCasoSections}">
                <p:ajax event="tabChange" listener="#{casoController.onChangeActiveIndexCasoSections}" oncomplete="resizeScrollPanel();"/>
                <p:ajax event="tabClose" listener="#{casoScheduleController.onTabClose}" />


                <p:tab id="tab-actividades" title="Actividades (#{casoController.selected.notaList.size()})">
                    <p:scrollPanel id="scrollpaneActividades" mode="native" style="border: 0;">
                        <ui:include src="responder.xhtml" />
                        <br/>
                        <ui:include src="actividadesListForm.xhtml" />
                    </p:scrollPanel>
                </p:tab>



                <p:tab id="tabAgendarEvento" title="Agenda (#{casoController.selected.scheduleEventList.size()})">

                    <p:scrollPanel id="scrollpaneAgenda" mode="native" style="border: 0; height: 500px;">

                        <h:form id="formAgendarEvento">
                            <h2>Calendario de Eventos</h2>

                            <p:schedule id="myschedule" value="#{casoScheduleController.lazyScheduleEventsModel}" 
                                        aspectRatio="4"
                                        firstHour="8" widgetVar="myschedule" >
                                <p:ajax event="dateSelect" listener="#{casoScheduleController.onDateSelect}"  
                                        disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                        update=":createEventForm:eventDetails" oncomplete="PF('createEventDialog').show();PF('viewEventDialog').hide()" />  

                                <p:ajax event="eventSelect" listener="#{casoScheduleController.onEventSelect}" 
                                        disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                        update=":viewEventForm :viewEventForm:panelClientesInvitados:panelclientesinvitados" oncomplete="PF('viewEventDialog').show();PF('createEventDialog').hide();" />  

                                <p:ajax event="eventMove" listener="#{casoScheduleController.onEventMove}" 
                                        disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                        update=":inputPanel:formTimelineAgenda :mainform:messages" />  
                                <p:ajax event="eventResize" listener="#{casoScheduleController.onEventResize}" 
                                        disabled="#{(not casoController.verificarCrearActividad()) and (not casoController.verificarResponderCaso())}"
                                        update=":inputPanel:formTimelineAgenda :mainform:messages" /> 
                            </p:schedule>
                        </h:form>

                        <p:separator/>

                        <h:form id="formTimelineAgenda">

                            <h2>Cronograma de Eventos</h2>

                            <pe:timeline id="timelineEvents" value="#{casoTimelineController.modelScheduleEvents}" var="event"  
                                         responsive="true"  timeZone="#{casoTimelineController.timeZone}" 
                                         showNavigation="true" 
                                         editable="false" eventStyle="dot"
                                         showButtonNew="false" minHeight="200" widgetVar="timelineWdgt">  

                                <h:panelGrid columns="1">  
                                    <i class="fa fa-calendar"></i>
                                    <h:outputText value="#{event.title}"/>  
                                    <h:outputText value="Agendado por: #{event.idUsuario ne null ? event.idUsuario:''} (#{casoController.prettyDate(event.startDate)})"/>  

                                </h:panelGrid> 


                            </pe:timeline>  
                        </h:form>
                    </p:scrollPanel>
                </p:tab>  

                <p:tab id="tabArchivos" title="Adjuntos (#{casoController.cantidadAttachment()})">
                    <h:form id="formlistaadjuntos">

                        <h:panelGroup id="listaadjuntos" layout="block">

                            <c:forEach items="#{casoController.selected.attachmentsNotEmbedded}" var="caso_attachment" >
                                <h:panelGrid columns="6">
                                    <p:graphicImage name="file_extension_#{caso_attachment.fileExtension}.png" library="file_extension_icons" />
                                    <p:commandLink ajax="false" value="#{caso_attachment.nombreArchivo}" 
                                                   title="Descargar #{caso_attachment.nombreArchivo} (#{caso_attachment.mimeType})">
                                        <p:fileDownload value="#{casoController.bajarArchivo(caso_attachment.idAttachment)}" />
                                    </p:commandLink>
                                    <h:outputText value="#{caso_attachment.fileSizeHuman}" style="color: #7A7A7A"/>
                                    <p:lightBox iframe="true" iframeTitle="#{caso_attachment.nombreArchivoOriginal}"
                                                rendered="#{caso_attachment.isPdf() or caso_attachment.isImage()}"> 
                                        <h:outputLink  value="#{facesContext.externalContext.requestContextPath}/DownloadFileServlet?id=#{caso_attachment.idAttachment}" 
                                                       styleClass="ui-icon ui-icon-search"
                                                       title="Preview">  
                                        </h:outputLink>
                                    </p:lightBox>
                                    <p:commandLink  title="Eliminar #{caso_attachment.nombreArchivo} (#{caso_attachment.mimeType})"
                                                    onclick="PF('borrarAttachment').show();"
                                                    disabled="#{not casoController.verificarGrabarCaso()}">
                                        <i class="fa fa-times"></i>
                                        <f:setPropertyActionListener target="#{casoController.idFileDelete}" value="#{caso_attachment.idAttachment}"/>
                                    </p:commandLink>
                                </h:panelGrid>
                            </c:forEach>

                        </h:panelGroup>

                        <br/>

                        <p:fileUpload id="fileupload"
                                      sizeLimit="5242880"
                                      invalidSizeMessage="El archivo excede el tamaño maximo: 5MB."
                                      fileUploadListener="#{casoController.subir}"
                                      disabled="#{not casoController.verificarGrabarCaso()}"
                                      label="Subir Documentos"
                                      uploadLabel="Subir"
                                      cancelLabel="Cancelar Subida"
                                      invalidFileMessage="Archivo Invalido." 
                                      mode="advanced"
                                      dragDropSupport="true"
                                      auto="true"
                                      update=":mainform:messages listaadjuntos :inputPanel:formCreateNota:listaadjuntosrespuesta"
                                      multiple="true"  
                                      rendered="#{casoController.selected.open}"/>

                        <p:tooltip for="fileupload" value="Sugerencia: Arrastre y suelte los archivos en esta área del caso para adjuntarlos."/>
                    </h:form>


                </p:tab>

                <p:tab id="tabCasosRelacionados" title="Casos Relacionados (#{casoController.selected.casosRelacionadosList.size() + casoController.selected.casosHijosList.size()})" >
                    <p:scrollPanel id="scrollpaneCasosRel" mode="native" style="border: 0; height: 500px;">

                        <div align="right">

                            <p:commandButton rendered="#{casoController.verificarRelacionarCaso() and not casoController.mergeHabilitado}" icon="fa fa-trash-o" 
                                             actionListener="#{casoController.chooseCasoFromDialog()}"
                                             ajax="true" value="Eliminar Relaci&oacute;n Caso" >
                                <p:ajax event="dialogReturn" listener="#{casoController.onCasoChosenForEliminarRelacionado}"  update=":inputPanel:tabCasosRelacionados"/>
                            </p:commandButton>
                            &nbsp;
                            <p:commandButton actionListener="#{casoController.enableMerge()}" rendered="false"
                                             value="Habilitar combinar con caso actual"
                                             icon="mergeIcon"
                                             update="scrollpaneCasosRel"/>
                            <p:commandButton actionListener="#{casoController.enableMerge()}" rendered="#{casoController.mergeHabilitado}"
                                             value="Cancelar"
                                             icon="ui-icon-close"
                                             update="scrollpaneCasosRel"/>
                            &nbsp;
                            <p:commandButton actionListener="#{casoController.mergeSelectedCasos()}" rendered="#{casoController.mergeHabilitado}"
                                             value="Combinar"
                                             icon="mergeIcon"
                                             update=":botoneraCaso scrollpaneCasosRel"/>
                        </div>
                        <br/>

                        <go:casoList id="casosMerge" rendered="#{casoController.mergeHabilitado}"
                                     selectionMultiple="true"
                                     casosList="#{casoController.mergeCandidatesList}"
                                     header="Candidatos para combinar (#{casoController.mergeCandidatesList.size()}) con caso N°#{casoController.selected.idCaso}"/>


                        <go:casoList id="casosRel" rendered="#{not casoController.mergeHabilitado}"
                                     casosList="#{casoController.selected.casosRelacionadosList}"
                                     header="Casos relacionados (#{casoController.selected.casosRelacionadosList.size()})"/>

                        <go:casoList id="subCasos" rendered="#{not casoController.mergeHabilitado}"
                                     casosList="#{casoController.selected.casosHijosList}"
                                     header="Sub casos (#{casoController.selected.casosHijosList.size()})"/>

                    </p:scrollPanel>
                </p:tab>

                <p:tab id="tab-timeline" title="Auditoría de eventos">

                    <p:scrollPanel id="scrollpaneTimeline" mode="native" style="border: 0; height: 500px;">


                        <div class="panel no-border panel-dark">
                            <div class="timeline">
                                <!-- Timeline header -->
                                <ui:repeat value="#{casoController.auditLogsCurrentCase}" var="audit" >

                                    <div class="tl-entry" >
                                        <div class="tl-time">
                                            <h:outputText value="#{casoController.prettyDate(audit.fecha)}"/>
                                        </div>
                                        <div class="tl-icon bg-info"><i class="fa fa-thumb-tack"></i></div>
                                        <div class="panel tl-body">
                                            #{(not empty audit.campo and not empty audit.oldValue) ? audit.campo.concat(' cambió de ').concat(audit.oldValue).concat(' a '):''}
                                            #{audit.newValue}

                                            <i class="text-muted text-sm">                                              
                                                <h:outputText value=" Realizado por: #{audit.idUser} "/>
                                                <h:outputText value="#{audit.fecha}">
                                                    <f:convertDateTime pattern="#{bundle.dateFormat2}" />
                                                </h:outputText>  
                                            </i>
                                        </div> <!-- / .tl-body -->
                                    </div> <!-- / .tl-entry -->

                                    <p:separator/>

                                </ui:repeat>
                            </div> <!-- / .timeline -->
                        </div>

                    </p:scrollPanel>

                </p:tab>

                <p:tab id="tabEditarEvento" title="Detalles del Evento" closable="true" 
                       rendered="#{casoScheduleController.event ne null}">

                    <h:form id="editEventForm">
                        <p:messages globalOnly="true"/>

                        <h:panelGrid columns="2" styleClass="filtersGrid">

                            <p:panelGrid id="eventDetails" 
                                         style="margin-bottom:10px;" styleClass="filtersGrid" >

                                <p:row>
                                    <p:column>
                                        <h:outputLabel value="Evento:" style="font-weight: bold;"/>  
                                    </p:column>

                                    <p:column>
                                        <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                                     required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                        <p:watermark for="title" value="Titulo del evento"/>
                                        <p:message for="title"/>
                                    </p:column>
                                </p:row>
                                <p:row>

                                    <p:column>
                                        <h:outputLabel value="Descripción:" style="font-weight: bold;"/>  
                                    </p:column>

                                    <p:column>
                                        <p:inplace editor="true">
                                            <f:facet name="output">
                                                <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para añadir una descripción'}" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                                <p:watermark for="desc" value="Descripción del evento"/>
                                            </f:facet>
                                        </p:inplace>

                                        <p:message for="desc"/>
                                    </p:column>
                                </p:row>

                                <p:row>

                                    <p:column>
                                        <h:outputLabel value="Fecha:" style="font-weight: bold;"/>  
                                    </p:column>

                                    <p:column>
                                        <p:panelGrid columns="6">

                                            <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <p:ajax event="dateSelect" update="endDate" />
                                            </p:calendar>  
                                            <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/>  
                                            <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de término.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                                <f:validator validatorId="primeDateRangeValidator" />
                                            </p:calendar>
                                            <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                                     label="Todo el dia"/>  
                                            <h:outputLabel for="allDay" value="Todo el día" style="font-weight: bold;"/> 
                                        </p:panelGrid>

                                        <p:message for="from"/>
                                        <p:message for="endDate"/>
                                        <p:message for="allDay"/>


                                    </p:column>


                                </p:row>

                                <p:row>
                                    <p:column>
                                        <h:outputLabel for="resources" value="Recursos:" style="font-weight: bold;"/>  
                                    </p:column>

                                    <p:column>

                                        <p:panelGrid columns="2">
                                            <p:autoComplete id="resources" value="#{casoScheduleController.selectedResourceToAddInvited}" 
                                                            completeMethod="#{casoScheduleController.autoCompleteResource}"  
                                                            var="rr"  itemValue="#{rr}" itemLabel="#{rr.nombre}">  

                                                <p:ajax  event="itemSelect" process="@this" listener="#{casoScheduleController.resourceInvitedItemSelectEvent}" 
                                                         update=":inputPanel:editEventForm:panelRecursos"  />

                                                <f:facet name="itemtip">
                                                    <h:panelGrid  columns="2" cellpadding="5">  
                                                        <f:facet name="header">  
                                                            <h:outputText value="#{rr.nombre}" />  
                                                        </f:facet>  

                                                        <h:outputText value="Nombre: " />  
                                                        <h:outputText value="#{rr.nombre}" />  

                                                        <h:outputText value="Tipo: " />  
                                                        <h:outputText value="#{rr.tipo}" /> 


                                                    </h:panelGrid>  
                                                </f:facet>  

                                            </p:autoComplete>   

                                            <p:panel id="panelRecursos">

                                                <h:outputText value="sin recursos" rendered="#{empty casoScheduleController.event.data.resourceList}"/>
                                                <ui:repeat id="rList" value="#{casoScheduleController.event.data.resourceList}" var="rSelected">
                                                    <h:panelGroup styleClass="ticket-status" style="background: #4abf5a; color: #FFFFFF;"
                                                                  layout="block">
                                                        <h:outputText   value="#{rSelected.nombre}"/>
                                                        <p:commandLink value="x" update=":inputPanel:editEventForm:panelRecursos" 
                                                                       process="@this"
                                                                       style="border: none !important;"
                                                                       styleClass="btn btn-xs btn-danger btn-outline">

                                                            <p:collector unique="true" value="#{rSelected}" 
                                                                         removeFrom="#{casoScheduleController.event.data.resourceList}"/>
                                                        </p:commandLink>
                                                    </h:panelGroup>&nbsp;

                                                </ui:repeat>
                                            </p:panel>
                                        </p:panelGrid>
                                        <p:watermark for="resources" value="Añadir recurso..."/>


                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputLabel for="recordatorios" value="Recordatorios:" style="font-weight: bold;"/>  
                                    </p:column>

                                    <p:column>
                                        <p:panel id="reminders">

                                            <ui:repeat id="recordatorios" value="#{casoScheduleController.event.data.scheduleEventReminderList}" var="reminder" >

                                                <h:panelGrid columns="4" cellpadding="5" cellspacing="5">

                                                    <h:selectOneMenu id="reminderType" 
                                                                     value="#{reminder.reminderType}" 
                                                                     required="true" requiredMessage="Se requiere ...">

                                                        <f:selectItem itemLabel="Correo" itemValue="EMAIL"/>
                                                        <f:selectItem itemLabel="Ventana emergente" itemValue="POPUP" itemDisabled="true"/>
                                                    </h:selectOneMenu>

                                                    <h:inputText id="quantityTime" value="#{reminder.quantityTime}" size="3" required="true" />

                                                    <h:selectOneMenu id="unitOfTimeInMinutes" 
                                                                     value="#{reminder.unitOfTimeInMinutes}" 
                                                                     required="true" requiredMessage="Se requiere ...">
                                                        <f:selectItem itemLabel="minutos" itemValue="1"/>
                                                        <f:selectItem itemLabel="horas" itemValue="60"/>
                                                        <f:selectItem itemLabel="días" itemValue="1440"/>
                                                        <f:selectItem itemLabel="semanas" itemValue="10080"/>
                                                    </h:selectOneMenu>

                                                    <p:commandLink value="eliminar" update=":inputPanel:editEventForm:eventDetails" immediate="true"
                                                                   style="color: #006dcc"
                                                                   actionListener="#{casoScheduleController.removeScheduleEventReminder(reminder)}" >

                                                    </p:commandLink>

                                                </h:panelGrid>


                                            </ui:repeat>
                                            <p:commandLink value="Agregar recordatorio" style="color: #006dcc"
                                                           actionListener="#{casoScheduleController.addNewScheduleEventReminder()}" 
                                                           immediate="true"
                                                           update=":inputPanel:editEventForm:reminders"/>
                                        </p:panel>

                                    </p:column>
                                </p:row>


                                <p:row>
                                    <p:column>

                                    </p:column>

                                    <p:column>
                                        <h:panelGrid columns="2">
                                            <h:selectBooleanCheckbox id="publicEventCheckbox" value="#{casoScheduleController.event.data.publicEvent}">
                                                <p:ajax update=":inputPanel:editEventForm:publicEvent" process="@this"/>  
                                            </h:selectBooleanCheckbox>
                                            <h:outputLabel for="publicEventCheckbox" value="Clientes pueden inscribirse al evento" 
                                                           title="Clientes pueden inscribirse al evento"/>  
                                        </h:panelGrid>

                                        <p:message for="publicEventCheckbox"/>

                                        <p:panel id="publicEvent" visible="#{casoScheduleController.event.data.publicEvent}">
                                            <p:panelGrid rendered="#{casoScheduleController.event.data.publicEvent}">
                                                <p:row>
                                                    <p:column>
                                                        <h:outputLabel value="Máx Inscritos" for="maxClientesInscritos" style="font-weight: bold;"/>
                                                    </p:column>

                                                    <p:column>
                                                        <p:inputText id="maxClientesInscritos" 
                                                                     value="#{casoScheduleController.event.data.maxClientesInscritos}" 
                                                                     required="true" requiredMessage="Se requiere que ingrese el máximo de Clientes Inscritos.">
                                                        </p:inputText>
                                                        <br/>
                                                        <h:outputFormat value="Podrán inscribirse sólo aquellos clientes que sean {0} de {1} de {2} {3} {4}">
                                                            <f:param value="Propietarios" />
                                                            <f:param value="#{casoController.selected.idSubComponente ne null ? casoController.selected.idSubComponente.nombre:'cualquier '.concat(applicationBean.productSubComponentDescription)}" />
                                                            <f:param value="#{casoController.selected.idModelo ne null ? 'modelo '.concat(casoController.selected.idModelo.nombre):'cualquier modelo'}" />
                                                            <f:param value="#{casoController.selected.idComponente ne null ? ''.concat(applicationBean.productComponentDescription).concat(': ').concat(casoController.selected.idComponente.nombre):'cualquier '.concat(applicationBean.productComponentDescription)}" />
                                                            <f:param value="#{casoController.selected.idProducto ne null ? ''.concat(applicationBean.productDescription).concat(': ').concat(casoController.selected.idProducto.nombre):'cualquier '.concat(applicationBean.productDescription)}" />

                                                        </h:outputFormat>
                                                        <p:message for="maxClientesInscritos"/>
                                                    </p:column>
                                                </p:row>
                                            </p:panelGrid>
                                        </p:panel>
                                    </p:column>
                                </p:row>


                                <p:row>
                                    <p:column>

                                    </p:column>

                                    <p:column>
                                        <h:panelGrid columns="2">
                                            <h:selectBooleanCheckbox id="accionAutomaticaBool" value="#{casoScheduleController.event.data.executeAction}">
                                                <p:ajax update=":inputPanel:editEventForm:action" process="@this"/>  
                                            </h:selectBooleanCheckbox>
                                            <h:outputLabel for="accionAutomaticaBool" value="Programar una acción automática" 
                                                           title="Programar una tarea o acción que se ejecutará automáticamente cuando se cumpla la fecha del evento..."/>  
                                        </h:panelGrid>

                                        <p:message for="accionAutomaticaBool"/>

                                        <p:panel id="action" visible="#{casoScheduleController.event.data.executeAction}">
                                            <p:panelGrid rendered="#{casoScheduleController.event.data.executeAction}">
                                                <p:row>
                                                    <p:column>
                                                        <h:outputLabel id="labelTipoAccion" value="Acción:" for="idTipoAccion" style="font-weight: bold;"/>
                                                    </p:column>

                                                    <p:column>
                                                        <h:selectOneMenu id="idTipoAccion" styleClass="form-control"
                                                                         value="#{casoScheduleController.event.data.idTipoAccion}" 
                                                                         required="true" requiredMessage="Se requiere que seleccione el nombre de una clase que implemente la Accion."
                                                                         >
                                                            <p:ajax update=":inputPanel:editEventForm:action" />
                                                            <f:selectItems value="#{nombreAccionController.itemsAvailableSelectOneImplementingActionClass}"/>
                                                        </h:selectOneMenu>
                                                        <p:message for="idTipoAccion"/>
                                                    </p:column>
                                                </p:row>




                                                <p:row rendered="#{casoScheduleController.event.data.executeAction}">
                                                    <p:column>
                                                        <h:outputLabel id="labelidAccionCustom" value="Propiedades:" for="idAccionCustom" style="font-weight: bold;" />
                                                    </p:column>

                                                    <p:column>
                                                        <p:inputTextarea id="idAccionCustom" value="#{casoScheduleController.event.data.parametrosAccion}"  style="width: 100%;"
                                                                         title="#{bundle.CreateAccionLabel_parametros}"/>
                                                        <p:message for="idAccionCustom"/>
                                                    </p:column>
                                                </p:row>

                                            </p:panelGrid>
                                        </p:panel>
                                    </p:column>
                                </p:row>





                            </p:panelGrid> 
                            <h:panelGroup>

                                <p:panelGrid>
                                    <p:row>
                                        <p:column>
                                            <go:panelUsuariosInvitados id="panelUsuariosInvitados"/>
                                        </p:column>
                                    </p:row>

                                </p:panelGrid>

                                <p:panelGrid>

                                    <p:row>
                                        <p:column>
                                            <go:panelClientesInvitados id="panelClientesInvitados2"/>
                                        </p:column>
                                    </p:row>

                                </p:panelGrid>

                            </h:panelGroup>  



                        </h:panelGrid>
                        <p:separator/>

                        <p:commandButton id="addButton" value="Guardar Evento" style="float: right;"
                                         actionListener="#{casoScheduleController.saveEvent()}" 
                                         update=":inputPanel"/>  
                        <br/>
                    </h:form>

                </p:tab>

            </p:tabView> 





        </ui:define>


        <ui:define name="dialogs">


            <p:confirmDialog closeOnEscape="true" global="true" showEffect="fade" hideEffect="explode" >
                <p:commandButton value="Si" type="button" styleClass="btn btn-danger ui-confirmdialog-yes" icon="ui-icon-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/> 	
            </p:confirmDialog>

            <p:dialog header="Asignarme el Caso" widgetVar="tomarCaso" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:outputLabel value="¿Está seguro de auto-asignarse el Caso y todos sus Sub-Casos?" /><br></br>
                    <div style="text-align: right">
                        <p:commandButton value="Si"
                                         actionListener="#{casoController.tomarCaso}" ajax="false" />
                        <p:commandButton value="No" onclick="PF('tomarCaso').hide()" type="button" />
                    </div>
                </h:form>
            </p:dialog>

            <p:dialog header="Datos Cliente" widgetVar="dialogClient" modal="true" dynamic="true"  closeOnEscape="true" closable="false">
                <h:form id="formDatosCliente">
                    <p:messages globalOnly="true"/>

                    <h:panelGrid id="datosDelCliente" columns="3">
                        <p:outputLabel value="Email:" for="email" style="font-weight:bold"/>
                        <h:outputText id="email" value="#{casoController.selected.emailCliente}"/>
                        <p:message display="both" for="email"/>
                        <p:outputLabel value="#{bundle.CreateClienteLabel_rut}" for="rut" style="font-weight:bold"/>                        
                        <p:inputText id="rut" value="#{casoController.selected.idCliente.rut}" 
                                     title="#{bundle.CreateClienteTitle_rut}" validator="#{inputValidationBean.validarRut}">

                            <p:ajax event="blur" listener="#{casoController.formateaRut()}" update="rut,datosDelCliente"/>
                        </p:inputText>

                        <p:message display="both" for="rut"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_nombres}" for="nombres" style="font-weight:bold"/>

                        <p:inputText  id="nombres" value="#{casoController.selected.idCliente.nombres}" label="nombres" required="true" requiredMessage="Los nombres son requeridos"/>

                        <p:message display="both" for="nombres"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_apellidos}" for="apellidos" style="font-weight:bold"/>                      
                        <p:inputText  id="apellidos" value="#{casoController.selected.idCliente.apellidos}" label="apellidos"/>                        
                        <p:message display="both" for="apellidos"/>                   

                        <p:outputLabel value="Teléfono:" for="fono1" style="font-weight:bold"/>                    

                        <p:inputText  id="fono1" value="#{casoController.selected.idCliente.fono1}" label="fono1" validatorMessage="Fono no es valido">
                            <pe:keyFilter regEx="/[\d\.\+\-\(\)]/"/>
                        </p:inputText>

                        <p:message display="both" for="fono1"/>

                        <p:outputLabel value="Teléfono Adicional:" for="fono2" style="font-weight:bold"/>

                        <p:inputText  id="fono2" value="#{casoController.selected.idCliente.fono2}" label="fono2" validatorMessage="Fono no es valido">
                            <pe:keyFilter regEx="/[\d\.\+\-\(\)]/"/>
                        </p:inputText>

                        <p:message display="both" for="fono2"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_dirParticular}" for="dirParticular" style="font-weight:bold"/>

                        <p:inputTextarea id="dirParticular" autoResize="true" value="#{casoController.selected.idCliente.dirParticular}" 
                                         title="#{bundle.CreateClienteTitle_dirParticular}" cols="40" />

                        <p:message display="both" for="dirParticular"/>

                        <p:outputLabel value="#{bundle.CreateClienteLabel_dirComercial}" for="dirComercial" style="font-weight:bold"/>

                        <p:inputTextarea id="dirComercial" autoResize="true" value="#{casoController.selected.idCliente.dirComercial}" 
                                         title="#{bundle.CreateClienteTitle_dirComercial}" cols="40"/>

                        <p:message display="both" for="dirComercial"/>

                    </h:panelGrid>
                    <p:separator/>
                    <p:commandButton action="#{casoController.mergeCliente}" disabled="#{not (casoController.verificarGrabarCaso())}"
                                     value="Guardar" ajax="true" update=":formDatosCliente" icon="ui-icon-disk"/>  
                    <p:commandButton action="#{clienteController.prepareView(casoController.selected.idCliente, '/script/caso/Edit')}"
                                     value="Ver detalle" immediate="true" ajax="false" icon="ui-icon-circle-zoomin"/> 
                    <p:commandButton action="#{clienteController.prepareList}" value="Lista de clientes" immediate="true" ajax="false" icon="ui-icon-folder-open"/>          
                    <p:commandButton value="Cerrar" immediate="true" onclick="PF('dialogClient').hide()" icon="ui-icon-close" type="button"/>
                </h:form>
            </p:dialog>

            <p:dialog header="Confirmar Borrar Archivo" widgetVar="borrarAttachment" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <label id="textoEliminar" >¿Esta seguro de borrar el archivo?</label><br></br>
                    <br></br>
                    <div style="text-align: right">                       
                        <p:commandButton value="Si" update=":mainform:messages :inputPanel:formlistaadjuntos:listaadjuntos :inputPanel:formCreateNota"
                                         actionListener="#{casoController.deleteAttachment(actionEvent)}" onclick="PF('borrarAttachment').hide()"/>

                        <p:commandButton value="No" onclick="PF('borrarAttachment').hide()" type="button" />
                    </div>
                </h:form>
            </p:dialog>



            <p:dialog header="Editar Comentario" widgetVar="Nota" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formEditNota">
                    <p:messages globalOnly="true"/>


                    <h:panelGrid columns="3">                     

                        <p:outputLabel for="textoNotaVisibilidadPublica" value="Público:" style="font-weight:bold"/>
                        <p:selectBooleanCheckbox id="textoNotaVisibilidadPublica" value="#{casoController.selectedNota.visible}" />
                        <p:message for="textoNotaVisibilidadPublica"/>

                        <p:outputLabel for="nextResponseDue1" value="#{bundle.cambiarSLA}:" style="font-weight:bold"/>
                        <p:calendar locale="es" navigator="true" id="nextResponseDue1" showButtonPanel="true" mindate="#{applicationBean.now}" 
                                    value="#{casoController.selected.nextResponseDue}" 
                                    title="Next Follow Up Due" pattern="dd/MM/yyyy HH:mm" label="SLA:"/>
                        <p:message for="nextResponseDue1"/>

                        <p:outputLabel value="#{bundle.cambiarSubEstado}:" for="idSubEstadox" style="font-weight:bold"/>
                        <p:selectOneMenu rendered="#{!casoController.selected.closed}" id="idSubEstadox" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}"/>
                        </p:selectOneMenu>

                        <p:selectOneMenu rendered="#{casoController.selected.closed}" id="idSubEstado2" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoCerrado}"/>
                        </p:selectOneMenu>
                        <p:message for="idSubEstadox"/>


                    </h:panelGrid>
                    <pe:ckEditor value="#{casoController.selectedNota.texto}" required="true" language="es"
                                 toolbar="#{applicationBean.ckEditorToolbar}"
                                 customConfig="#{request.contextPath}/resources/js/ckeditor.js"
                                 id="textonota" width="560" height="210"/>

                    <p:commandButton value="Cancelar" ajax="true"  onclick="PF('Nota').hide()"  update=":formint1" />

                    <p:commandButton value="Guardar" ajax="false" update=":formint1 :formCreateNota :inputPanel:formlistaadjuntos" actionListener="#{casoController.editNota(false)}"/>
                    <p:commandButton value="Guardar y notificar al cliente" ajax="false" update=":formint1 :formCreateNota :inputPanel:formlistaadjuntos" actionListener="#{casoController.editNota(true)}"/>


                </h:form>
            </p:dialog>

            <p:dialog header="Cerrar Caso" widgetVar="closeCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formCerrarCaso">

                    <p:messages/>

                    <h:panelGrid columns="3">

                        <p:outputLabel for="idSubEstado2"  value="Causa de cierre del caso:" style="font-weight: bold;"/>
                        <p:selectOneMenu id="idSubEstado2" value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoCerrado}" 
                                           var="subEstad" itemDescription="#{subEstad.description}"/>
                        </p:selectOneMenu>
                        <p:message for="idSubEstado2" />  

                        <p:outputLabel for="nota"  value="Nota de cierre:" style="font-weight: bold;"/>
                        <p:inputTextarea id="nota" value="#{casoController.textoNota}" />
                        <p:message for="nota" />  

                    </h:panelGrid>

                    <p:outputLabel value="Nota: se cerrarán también los sub-casos (casos hijos del caso actual), si existen."
                                   rendered="#{casoController.selected.tipoCaso ne EnumTipoCaso.ENTREGA.getTipoCaso()}"/>
                    <p:outputLabel value="Nota: Todos los subcasos deben estar previamente cerrados."
                                   rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}"/>

                    <h:panelGrid columns="3">

                        <p:commandButton value="Cancelar" ajax="true"  onclick="PF('closeCase').hide()"   />

                        <p:commandButton value="Aceptar" ajax="true" update="formCerrarCaso :mainform:messages"
                                         actionListener="#{casoController.cerrarCaso}"  />

                        <p:commandButton value="Cerrar el caso y programar visita preventiva" 
                                         rendered="#{casoController.selected.tipoCaso eq EnumTipoCaso.ENTREGA.getTipoCaso()}"
                                         ajax="true" update=":formCerrarCaso :mainform:messages"
                                         actionListener="#{casoController.cerrarCasoYProgramarVP}"   />
                    </h:panelGrid>

                </h:form>
            </p:dialog>

            <p:dialog header="Eliminar Caso" widgetVar="destroyCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="formEliminarCaso">
                    <h:outputLabel value="#{bundle.EliminarCaso}" />
                    <br/><br/>
                    <p:commandButton value="Cancelar" ajax="true"  onclick="PF('destroyCase').hide()"   />

                    <p:commandButton rendered="#{casoController.verificarEliminarCaso()}"
                                     ajax="false" value="Eliminar Caso" action="#{casoController.destroy()}"/>

                </h:form>
            </p:dialog>

            <p:dialog header="ReAbrir Caso" widgetVar="openCase" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:outputLabel value="#{bundle.ReabrirCaso}" />

                    <br>
                        <p:outputLabel value="#{bundle.EditCasoLabel_idSubEstado}" for="idSubEstadoreopen" style="font-weight:bold"/>
                        <p:selectOneMenu id="idSubEstadoreopen"  
                                         filter="true" filterMatchMode="contains"
                                         value="#{casoController.selected.idSubEstado}" >
                            <f:selectItems value="#{casoController.itemsSubEstadoCasoAvailableSelectOneCasoAbierto}" var="subEstad" itemDescription="#{subEstad.description}"/>

                        </p:selectOneMenu>
                    </br>

                    <p:commandButton value="Cancelar" ajax="true"  onclick="PF('openCase').hide()"   />

                    <p:commandButton value="Aceptar" ajax="false" update=":mainform:messages"
                                     actionListener="#{casoController.reabrirCaso}"   />

                </h:form>
            </p:dialog>

            <p:dialog header="Agregar Caso Relacionado" widgetVar="casosRela" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form>
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Caso a relacionar:" for="idcasorel" style="font-weight: bold"/>

                        <p:autoComplete id="idcasorel" value="#{casoController.idCaserel}" 
                                        completeMethod="#{casoController.complete}"
                                        var="item" itemLabel="#{item.tema}" itemValue="#{item}" forceSelection="true">


                            <p:column>
                                <h:outputText value="#{item.clientName}" />
                            </p:column>

                            <p:column>
                                <h:panelGroup layout="block">
                                    <h:outputText styleClass="ticket-status" style="background: \##{item.idSubEstado.backgroundColor}; color: \##{item.idSubEstado.fontColor};" value="#{item.idSubEstado.nombre}"/>
                                    <p:outputLabel id="temalink" value="#{item.tipoCaso.nombre} \##{item.idCaso} #{item.tema} (#{item.notaList.size()})">
                                    </p:outputLabel>
                                    <h:panelGroup rendered="#{item.hasScheduledEvents}">
                                        <i class="fa fa-calendar"></i>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{item.hasAttachments}">
                                        <i class="fa fa-paperclip"></i>    
                                    </h:panelGroup>
                                </h:panelGroup>
                            </p:column>
                        </p:autoComplete>

                        <p:button value="Cancelar" onclick="PF('casosRela').hide()"   />
                        <p:commandButton value="Aceptar" ajax="true" update=":mainform:messages :inputPanel:tabCasosRelacionados"
                                         actionListener="#{casoController.agregarRelacionado}"   />

                    </h:panelGrid>
                </h:form>
            </p:dialog>



            <p:dialog id="idDialogArbolItem" header="Seleccione Item" widgetVar="idDialogArbolItem" dynamic="true" rendered="#{casoController.casoTipoReparacion}"
                      modal="true" height="550" closeOnEscape="true" closable="false">
                <h:form id="formArbolItem">
                    <div align="left">
                        <p:tree id="arbol" value="#{itemController.tree}" var="node" dynamic="true" cache="false"
                                selectionMode="single" selection="#{itemController.item}"
                                style="border-color: window;">
                            <p:ajax event="select" listener="#{casoController.onNodeItemSelectedInSelectedCaso}" 
                                    update=":inputPanel:formact:listanotas:panelGridDatos" oncomplete="PF('idDialogArbolItem').hide()"/>
                            <p:treeNode expandedIcon="myfoldericon16" collapsedIcon="myfoldericon16">
                                <h:outputText value="#{node.nombre}" />
                            </p:treeNode>
                        </p:tree>
                    </div>
                </h:form>
            </p:dialog>

            <p:dialog header="Transferir Caso" widgetVar="transferir" modal="true" dynamic="true" closeOnEscape="true" closable="false">
                <h:form id="transferForm">

                    <p:panel id="panel-transferir">

                        <p:messages />

                        <!-- enable focus component -->
                        <p:focus context="panel-transferir" />

                        <p:panelGrid style="margin-bottom:10px;" styleClass="filtersGrid">
                            <p:row>

                                <p:column colspan="2">
                                    <p:outputPanel id="tipoTransferPanel">  
                                        <p:selectOneRadio id="tipoTransfer" value="#{casoController.tipoTransferOption}" layout="custom">  
                                            <f:selectItem itemLabel="A otro Agente" itemValue="1" />  
                                            <f:selectItem itemLabel="A otro Cliente" itemValue="2" />                          
                                            <p:ajax update=":transferForm:tipoTransferPanel" listener="#{vistaController.handleAnyChangeEvent()}" /> 
                                        </p:selectOneRadio>  



                                        <h:panelGrid>

                                            <h:panelGrid columns="3">
                                                <p:radioButton id="idAgente" for="tipoTransfer" itemIndex="0"/>  
                                                <h:outputLabel value="A otro Agente:" for="idAgente" style="font-weight: bold"/>
                                                <p:selectOneMenu id="owner1" value="#{casoController.usuarioSeleccionadoTransfer}" filter="true" filterMatchMode="contains"
                                                                 required="true" requiredMessage="Debe Seleccionar un agente si desea transferir el caso."
                                                                 rendered="#{casoController.tipoTransferOption eq 1}">

                                                    <f:selectItems value="#{usuarioController.itemsAvailableSelectOneNoSystem}"/>
                                                </p:selectOneMenu>

                                            </h:panelGrid>

                                            <h:panelGrid columns="3">
                                                <p:radioButton id="idCliente" for="tipoTransfer" itemIndex="1"/>  
                                                <h:outputLabel value="A otro Cliente:" for="idCliente" style="font-weight: bold"/>
                                                <p:autoComplete value="#{casoController.emailClienteSeleccionadoTransfer}"
                                                                completeMethod="#{emailClienteController.completeEmailCliente}"  
                                                                var="email" itemValue="#{email}" itemLabel="#{email.emailCliente}"
                                                                required="true" requiredMessage="Debe Seleccionar un cliente si desea transferir el caso."
                                                                rendered="#{casoController.tipoTransferOption eq 2}">  

                                                    <f:facet name="itemtip">  
                                                        <h:panelGrid  columns="2" cellpadding="5">  
                                                            <f:facet name="header">  
                                                                <h:outputText value="#{email.emailCliente}" />  
                                                            </f:facet>  

                                                            <h:outputText value="Nombre: " />  
                                                            <h:outputText value="#{email.cliente.nombres}" />  

                                                            <h:outputText value="Apellidos: " />  
                                                            <h:outputText value="#{email.cliente.apellidos}" /> 

                                                            <h:outputText value="Rut: " />  
                                                            <h:outputText value="#{email.cliente.rut}" /> 
                                                        </h:panelGrid>  
                                                    </f:facet>  

                                                </p:autoComplete>               



                                            </h:panelGrid>


                                        </h:panelGrid>  
                                    </p:outputPanel>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">
                                    <h:outputLabel value="Motivo de transferencia: " for="owner1"  style="font-weight: bold"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">
                                    <p:inputTextarea id="transferNote" value="#{casoController.textoNota}" style="width: 100%;" required="true" requiredMessage="El Motivo de la transferencia o asignación es requerido."/> 
                                    <p:watermark for="transferNote" value="Ingrese un motivo" />
                                </p:column>
                            </p:row>

                        </p:panelGrid>

                        <f:facet name="footer">
                            <p:commandButton value="Cancelar" onclick="PF('transferir').hide()" type="button" /> 

                            <p:commandButton value="Transferir" update=":transferForm :inputPanel:formact :formint1" actionListener="#{casoController.asignarCaso}"  />
                        </f:facet>
                    </p:panel>



                </h:form>
            </p:dialog>


            <p:dialog id="createEventDialog" widgetVar="createEventDialog" header="Crear Evento" dynamic="true"
                      showEffect="fade" hideEffect="fade" closeOnEscape="true" closable="false">  
                <h:form id="createEventForm">

                    <p:panelGrid id="eventDetails" columns="1" 
                                 style="margin-bottom:10px;" styleClass="filtersGrid" >

                        <p:messages globalOnly="true"/>

                        <p:row>
                            <p:column>
                                <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                             required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                <p:watermark for="title" value="Titulo del evento"/>
                                <p:message for="title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para añadir una descripción'}" />
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                        <p:watermark for="desc" value="Descripción del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="desc"/>
                            </p:column>
                        </p:row>
                        <p:separator/>
                        <p:row>

                            <p:column>
                                <h:outputLabel value="Fecha:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:panelGrid columns="6">
                                    <h:outputLabel for="from" value="Desde:" style="font-weight: bold;"/>  
                                    <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                pattern="dd/MM/yyyy HH:mm"
                                                required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                        <p:ajax event="dateSelect" update="endDate" />
                                    </p:calendar>  
                                    <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/>  
                                    <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                pattern="dd/MM/yyyy HH:mm"
                                                required="true" requiredMessage="Favor ingrese fecha y hora de término.">  
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                        <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                        <f:validator validatorId="primeDateRangeValidator" />
                                    </p:calendar>
                                    <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                             label="Todo el dia"/>  
                                    <h:outputLabel for="allDay" value="Todo el día" style="font-weight: bold;"/> 
                                </p:panelGrid>

                                <p:message for="from"/>
                                <p:message for="endDate"/>
                                <p:message for="allDay"/>


                            </p:column>


                        </p:row>

                        <p:separator/>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="Organizador:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{casoScheduleController.event.data.idUsuario.capitalName}"/>
                            </p:column>
                        </p:row>

                    </p:panelGrid>  

                    <p:separator/>
                    <p:commandButton value="Cerrar" oncomplete="PF('createEventDialog').hide();" update=":createEventForm:eventDetails" process="@this">
                        <p:resetInput target="@form" />
                    </p:commandButton>
                    &nbsp;
                    <p:commandButton id="addButton" value="Crear Evento" 
                                     actionListener="#{casoScheduleController.addEvent()}"
                                     update=":createEventForm:eventDetails" />  

                    &nbsp;
                    <p:commandLink id="editButton" value="Editar evento »" 
                                   style="font-weight: bold;float: right;color: #15c;text-decoration: underline;cursor: pointer;white-space: nowrap;"
                                   actionListener="#{casoScheduleController.goEditEvent()}" update=":createEventForm:eventDetails"/>
                </h:form>
            </p:dialog>

            <p:dialog id="viewEventDialog" widgetVar="viewEventDialog" header="Evento" dynamic="true"
                      showEffect="fade" hideEffect="fade" closeOnEscape="true" closable="true" modal="true">  
                <h:form id="viewEventForm">

                    <p:messages globalOnly="true"/>


                    <p:panelGrid columns="1" styleClass="filtersGrid">

                        <p:row>
                            <p:column colspan="2">
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <p:outputLabel value="#{casoScheduleController.event.title}" title="#{casoScheduleController.event.data.eventId}" style="font-weight: bold;"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText id="title" value="#{casoScheduleController.event.title}" style="width: 100%;"
                                                     required="true" requiredMessage="Favor ingrese un titulo para el evento."/> 
                                        <p:watermark for="title" value="Titulo del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="title"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column colspan="2">
                                <p:panelGrid columns="6">

                                    <p:inplace editor="true">
                                        <f:facet name="output">
                                            <h:outputText value="#{casoController.formatDateRange(casoScheduleController.event.startDate, casoScheduleController.event.endDate)}" />
                                            <h:outputText value="#{casoScheduleController.event.allDay eq true ? ' Todo el dia':''}" />
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:calendar id="from" value="#{casoScheduleController.event.startDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de comienzo.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <p:ajax event="dateSelect" update="endDate" />
                                            </p:calendar>  
                                            <h:outputLabel for="endDate" value="Hasta:" style="font-weight: bold;"/> 
                                            <p:calendar id="endDate" mindate="#{casoScheduleController.event.startDate}" value="#{casoScheduleController.event.endDate}" size="14"
                                                        pattern="dd/MM/yyyy HH:mm"
                                                        required="true" requiredMessage="Favor ingrese fecha y hora de término.">  
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />  
                                                <f:attribute name="startDate" value="#{casoScheduleController.event.startDate}" />
                                                <f:validator validatorId="primeDateRangeValidator" />
                                            </p:calendar>

                                            <h:selectBooleanCheckbox id="allDay" value="#{casoScheduleController.event.allDay}"
                                                                     label="Todo el dia"/>  
                                            <h:outputLabel for="allDay" value="Todo el día" style="font-weight: bold;"/> 
                                        </f:facet>
                                    </p:inplace>

                                </p:panelGrid>

                                <p:message for="from"/>
                                <p:message for="endDate"/>
                                <p:message for="allDay"/>

                            </p:column>


                        </p:row>

                        <p:row>
                            <p:column colspan="2">
                                <p:inplace editor="true">
                                    <f:facet name="output">
                                        <h:outputText value="#{not empty casoScheduleController.event.data.descripcion ? casoScheduleController.event.data.descripcion:'Haz click para añadir una descripción'}" />
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputTextarea id="desc" value="#{casoScheduleController.event.data.descripcion}" style="width: 100%;"/> 
                                        <p:watermark for="desc" value="Descripción del evento"/>
                                    </f:facet>
                                </p:inplace>

                                <p:message for="desc"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <h:outputLabel value="Organizador:" style="font-weight: bold;"/>  
                            </p:column>

                            <p:column>
                                <p:outputLabel value="#{casoScheduleController.event.data.idUsuario.capitalName}"/>
                            </p:column>
                        </p:row>

                        <p:row>
                            <p:column>
                                <p:panelGrid columns="2" styleClass="filtersGrid" >

                                    <p:panelGrid columns="1" rendered="#{not empty casoScheduleController.event.data.usuariosInvitedList}"
                                                 style="margin-bottom:10px;" styleClass="filtersGrid" >

                                        <p:row>
                                            <p:column>
                                                <go:panelUsuariosInvitados id="panelUsuariosInvitados"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                    <p:panelGrid columns="1" rendered="#{not empty casoScheduleController.event.data.scheduleEventClientList}"
                                                 style="margin-bottom:10px;" styleClass="filtersGrid" >
                                        <p:row>
                                            <p:column>
                                                <go:panelClientesInvitados id="panelClientesInvitados"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>

                                </p:panelGrid>
                            </p:column>
                        </p:row>


                    </p:panelGrid>

                    <p:separator/>

                    <p:commandButton id="delButton" value="Eliminar evento" styleClass="btn btn-danger"
                                     actionListener="#{casoScheduleController.deleteSelectedEvent()}">
                        <p:confirm header="Confirmación" message="Esta seguro de eliminar el evento ?" icon="ui-icon-alert"/>
                    </p:commandButton>

                    &nbsp;
                    <p:commandButton value="Cerrar" 
                                     actionListener="#{casoScheduleController.closeViewEvent()}" update=":viewEventForm" process="@this">
                        <p:resetInput target="@form" />
                    </p:commandButton>


                    &nbsp;

                    <p:commandButton id="addButton" value="Guardar"
                                     actionListener="#{casoScheduleController.quickSaveEvent()}"
                                     update=":viewEventForm" />
                    &nbsp;
                    <p:commandLink id="editButton" value="Editar evento »" style="font-weight: bold;float: right;color: #15c;text-decoration: underline;cursor: pointer;white-space: nowrap;"
                                   actionListener="#{casoScheduleController.goEditEvent()}" update=":inputPanel"/>
                </h:form>
            </p:dialog>
            <script>
                //<![CDATA[
                $(document).ready(function () {
                    resizeScrollPanel();
                });

                function resizeScrollPanel() {
                    var layoutCenterPane = document.getElementsByClassName("ui-layout-content pe-layout-pane-content")[0];
                    var botoneraPanel = document.getElementById("botoneraCaso");
                    var inputPanel = document.getElementById("inputPanel");
                    var inputPanelHeight = (layoutCenterPane.clientHeight - botoneraPanel.clientHeight - 25);
                    inputPanel.style.height = (inputPanelHeight + "px");
                    var tabsBar = inputPanel.getElementsByClassName("ui-tabs-navscroller")[0];
                    var height = inputPanelHeight - (tabsBar.clientHeight + 30);
                    resizeComponent("inputPanel:scrollpaneActividades", height);
                    resizeComponent("inputPanel:scrollpaneAgenda", height);
                    resizeComponent("inputPanel:scrollpaneCasosRel", height);
                    resizeComponent("inputPanel:scrollpaneTimeline", height);
                }

                function resizeComponent(componentId, height) {
                    try {
                        var componentToResize = document.getElementById(componentId);
                        if (componentToResize !== null)
                        {
                            componentToResize.style.height = (height + "px");
                        }
                    } catch (err) {
                    }
                }

                var id;
                $(window).resize(function () {
                    id = setTimeout(resizeScrollPanel, 500);
                });

                //]]>
            </script>
        </ui:define>
    </ui:composition>

</html>
