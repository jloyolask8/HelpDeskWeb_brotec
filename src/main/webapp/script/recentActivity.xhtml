<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html [
    <!ENTITY nbsp "&#160;"> 
    ]>
    <ui:composition 
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:pe="http://primefaces.org/ui/extensions"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:go="http://java.sun.com/jsf/composite/go">

        <h:form id="activityForm">


            <div class="panel panel-transparent panel-dark widget-comments hidden-xs">
                <div class="panel-heading">
                    <span class="panel-title"><i class="panel-title-icon fa fa-comments"></i>Log de Actividad en tus casos</span>
                </div> <!-- / .panel-heading -->
                <div class="panel-body">

                    <c:forEach items="#{auditLogController.getActivityLogs(UserSessionBean.current.idUsuario)}" var="item" varStatus="loop">

                        <div class="comment">
                            <img src="#{facesContext.externalContext.requestContextPath}/resources/images/pixel-admin/avatar.png" alt="" class="comment-avatar"/>
                            <div class="comment-body">
                                <div class="comment-by">
                                    <span class="btn-link">#{item.idUser}</span> 
                                    #{item.idCampo eq null ? '':'ha cambiado el valor de '.concat(item.idCampo)} en <span class="btn-link">
                                        <h:outputText value="[ref\##{item.idCaso}]"/>
                                    </span>
                                </div>
                                <div class="comment-text">
                                    #{item.newValue}
                                </div>
                                <div class="comment-actions">
                                    <p:commandLink action="#{casoController.prepareEditCaso(item.idCaso)}" 
                                                   ajax="false" styleClass="btn-link" immediate="true">
                                        <i class="fa fa-pencil"></i>Abrir Caso
                                    </p:commandLink>
                                    <span class="pull-right" title="#{casoController.formatDate(item.fecha)}">
                                        #{casoController.prettyDate(item.fecha)}
                                    </span>
                                </div>
                            </div> <!-- / .comment-body -->
                        </div> <!-- / .comment -->

                    </c:forEach>

                </div> <!-- / .panel-body -->
            </div>

        </h:form>

    </ui:composition>
