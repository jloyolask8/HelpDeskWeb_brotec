<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

    <ui:composition template="/script/template_inbox_bootstrap_config.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.CreateUsuarioTitle}"></h:outputText>
        </ui:define>
        <ui:define name="help">
            <h:outputText escape="false" value="#{bundle.ayudaUsuarios}"/>
        </ui:define>

        <ui:define name="content_header">
            <script>
                var init = [];
                init.push(function () {
                    $('body').addClass('mmc');
                });
            </script>
            <!-- page-header -->
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-6 col-xs-12">
                        <h1><i style="font-size: small;" class="fa fa-plus"/> <i class="fa fa-user page-header-icon"></i>&nbsp;&nbsp;#{bundle.CreateUsuarioTitle}</h1>
                        <p:commandLink title="Ayuda Usuarios" onclick="PF('helpDialog').show()" styleClass="text-info" >
                            <i class="fa fa-info-circle"/>
                        </p:commandLink> 
                    </div>

                </div>
            </div><!-- / .page-header --> 
        </ui:define>


        <ui:define name="body">

            <h:form>
                <p:messages globalOnly="true"/>

                <p:fieldset legend="Identificación del usuario">
                    <div class="row">
                        <div class="col-sm-6 col-lg-4">
                            <div class="form-group">
                                <label style="font-weight: bold;" for="idUsuario" class="control-label">#{bundle.EditUsuarioLabel_idUsuario}</label>
                                <h:inputText styleClass="form-control" id="idUsuario" value="#{usuarioController.selected.idUsuario}" title="#{bundle.EditUsuarioTitle_idUsuario}"
                                             autocomplete="false" required="true" requiredMessage="#{bundle.EditUsuarioRequiredMessage_idUsuario}"/>
                                <p:message for="idUsuario"/>
                            </div>

                            <div class="form-group">
                                <label style="font-weight: bold;" for="Pass" class="control-label">Contraseña:</label>
                                <h:inputSecret styleClass="form-control" id="Pass" value="#{usuarioController.selected.pass}"
                                               title="Contraseña"
                                               autocomplete="false" required="true" requiredMessage="Se requiere una contraseña">
                                    <p:message for="Pass"/>
                                </h:inputSecret>
                            </div>

                            <div class="form-group">
                                <label style="font-weight: bold;" for="activo" class="control-label">#{bundle.EditUsuarioLabel_activo}</label>
                                <h:selectOneMenu styleClass="form-control" id="activo" style="width: 300px;"
                                                 value="#{usuarioController.selected.activo}">
                                    <f:selectItem itemLabel="Si" itemValue="true"/>
                                    <f:selectItem itemLabel="No" itemValue="false"/>
                                </h:selectOneMenu>
                                <p:message for="activo"/>
                            </div>
                        </div>
                    </div>
                </p:fieldset>
                <br/>
                <p:fieldset legend="Datos Personales">

                    <div class="row">
                        <div class="col-sm-6 col-lg-4">
                            <div class="form-group">
                                <label style="font-weight: bold;" for="rut" class="control-label">Rut:</label>
                                <h:inputText id="rut" styleClass="form-control" 
                                             value="#{usuarioController.selected.rut}" title="Rut del usuario">
                                    <p:ajax event="blur" listener="#{usuarioController.formateaRut}" update="rut,msgrut :mainform:messages"/>
                                </h:inputText>
                                <p:message id="msgrut" for="rut"/>
                            </div>
                            <div class="form-group">
                                <label style="font-weight: bold;" for="nombres" class="control-label">#{bundle.EditUsuarioLabel_nombres}</label>
                                <h:inputText id="nombres" styleClass="form-control" 
                                             value="#{usuarioController.selected.nombres}" title="#{bundle.EditUsuarioTitle_nombres}"
                                             />
                                <p:message for="nombres"/>
                            </div>
                            <div class="form-group">
                                <label style="font-weight: bold;" for="apellidos" class="control-label">#{bundle.EditUsuarioLabel_apellidos}</label>
                                <h:inputText id="apellidos" styleClass="form-control" 
                                             value="#{usuarioController.selected.apellidos}" title="#{bundle.EditUsuarioTitle_apellidos}"
                                             />
                                <p:message for="apellidos"/>
                            </div>
                            <div class="form-group">
                                <label style="font-weight: bold;" for="email" class="control-label">#{bundle.EditUsuarioLabel_email}</label>
                                <h:inputText id="email" styleClass="form-control" 
                                             value="#{usuarioController.selected.email}" title="#{bundle.EditUsuarioTitle_email}"
                                             />
                                <p:message for="email"/>
                                <p:watermark for="email" value="Ej: sunombre@sucorreo.com * "/>
                            </div>
                            <div class="form-group">
                                <label style="font-weight: bold;" for="telFijo" class="control-label">#{bundle.EditUsuarioLabel_telFijo}</label>
                                <h:inputText id="telFijo" styleClass="form-control" 
                                             value="#{usuarioController.selected.telFijo}" title="#{bundle.EditUsuarioTitle_telFijo}"
                                             />
                                <p:message for="telFijo"/>
                            </div>
                            <div class="form-group">
                                <label style="font-weight: bold;" for="telMovil" class="control-label">#{bundle.EditUsuarioLabel_telMovil}</label>
                                <h:inputText id="telMovil" styleClass="form-control" 
                                             value="#{usuarioController.selected.telMovil}" title="#{bundle.EditUsuarioTitle_telMovil}"
                                             />
                                <p:message for="telMovil"/>
                            </div>
                        </div>
                    </div>
                </p:fieldset>
                <br/>

                <p:fieldset legend="Datos de Organización"> 

                    <div class="row">
                        <div class="col-sm-6 col-lg-4">
                            <div class="form-group">
                                <label style="font-weight: bold;" for="supervisor" class="control-label">#{bundle.EditUsuarioLabel_supervisor}</label>
                                <h:selectOneMenu styleClass="form-control" id="supervisor" style="width: 300px;"
                                                 value="#{usuarioController.selected.supervisor}">
                                    <f:selectItems value="#{usuarioController.itemsAvailableSelectOneNoSystem}"/>
                                </h:selectOneMenu>
                                <p:message for="supervisor"/>
                            </div>

                            <div class="form-group">
                                <label style="font-weight: bold;" for="pojoPickList" class="control-label">Asignar Grupos al Usuario</label>
                                <p:pickList id="pojoPickList"  value="#{usuarioController.gruposDualListModel}" var="g" effect="slide" 
                                            itemValue="#{g}" itemLabel="#{g.nombre}" converter="GrupoConverter"
                                            showSourceControls="true" showTargetControls="true"  
                                            showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains"> 

                                    <f:facet name="sourceCaption">Grupos</f:facet> 
                                    <f:facet name="targetCaption">Seleccionados</f:facet> 
                                    <p:column> 
                                        #{g.nombre} 
                                    </p:column> 

                                </p:pickList>
                                <p:message for="pojoPickList"/>
                            </div>

                            <div class="form-group">
                                <label style="font-weight: bold;" for="rolList" class="control-label">Roles:</label>
                                <p:selectManyCheckbox id="rolList" converter="RolConverter" value="#{usuarioController.selected.rolList}" layout="pageDirection">
                                    <f:selectItems  value="#{rolController.itemsAvailableSelectMany}" itemLabel="nombre" itemValue="idRol"/>
                                </p:selectManyCheckbox>
                                <p:message for="rolList"/>
                            </div>

                        </div>
                    </div>
                </p:fieldset>

                <br/>

                <div class="btn-group">
                    <p:commandLink action="#{usuarioController.prepareList}" 
                                   styleClass="btn btn-default btn-flat" 
                                   ajax="false" immediate="true"
                                   rendered="#{filtroAcceso.verificarAccesoAFuncionEditarAjustes()}"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().removeClass('fa fa-chevron-left');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-chevron-left"></i> #{bundle.goBack}
                    </p:commandLink>
                </div>
                &nbsp;
                <div class="btn-group">
                    <p:commandLink action="#{usuarioController.create}" 
                                   ajax="false"
                                   styleClass="btn btn-primary btn-flat" 
                                   rendered="#{filtroAcceso.verificarAccesoAFuncionEditarAjustes()}"
                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                           jQuery(this).children().removeClass('fa fa-save');
                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                        <i class="fa fa-save"></i> #{bundle.CreateUsuarioSaveLink}
                    </p:commandLink>
                </div>

            </h:form>
        </ui:define>
    </ui:composition>

</html>
