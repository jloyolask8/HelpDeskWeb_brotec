<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:composition template="/script/template_inbox_bootstrap_config.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.EditTipoCasoTitle}"></h:outputText>
        </ui:define>

        <ui:define name="help">
            <h:outputLabel escape="false" value="#{bundle.ayudaTiposDeCasos}"/>
        </ui:define>

        <ui:define name="content_header">
            <script>
                var init = [];
                init.push(function () {
                    $('body').addClass('mmc');
                });
            </script>
            <!-- page-header -->
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-6 col-xs-12">
                        <h1><i class="fa fa-building page-header-icon"></i>&nbsp;&nbsp;#{bundle.EditTipoCasoTitle}</h1>
                        <p:commandLink title="Help" onclick="PF('helpDialog').show()" styleClass="text-info" >
                            <i class="fa fa-info-circle"/>
                        </p:commandLink> 
                    </div>

                </div>
            </div><!-- / .page-header --> 
        </ui:define>

        <ui:define name="help">

            <p class="help-block">Cualquiera sea el tipo, un caso puede estar en dos estados: "Abierto" o "Cerrado".
                Para definir los sub-estados en los cuales puede estar el caso ud. debe indicar a que estado pertenece el sub-estado.
                Por ejemplo: Un caso del tipo Contacto cuando esta abierto puede tener los subestados: "Nuevo", "En proceso"... Al cerrarlo este puede
                estar en sub-estado: "Solucionado", "Respondido", "Invalido", Etc..</p>

        </ui:define>

        <ui:define name="body">

            <pe:importEnum type="com.itcs.helpdesk.persistence.entityenums.EnumEstadoCaso" var="EnumEstadoCaso" allSuffix="ALL_ENUM_VALUES" />

            <h:form>

                <div class="row">
                    <div class="col-sm-5 col-lg-5">


                        <div class="form-group">
                            <label class="control-label">#{bundle.CreateTipoCasoLabel_nombre}</label>
                            <p:inputText id="nombre" styleClass="form-control" value="#{tipoCasoController.selected.nombre}" 
                                         title="#{bundle.CreateTipoCasoTitle_nombre}" 
                                         required="true" requiredMessage="#{bundle.CreateTipoCasoRequiredMessage_nombre}"/>
                            <h:message for="nombre" errorClass="text-danger"/>
                        </div>



                        <div class="form-group">
                            <label class="control-label">#{bundle.CreateTipoCasoLabel_descripcion}</label>
                            <h:inputTextarea styleClass="form-control" id="descripcion" value="#{tipoCasoController.selected.descripcion}"  cols="50" />
                        </div>

                        <div class="row">
                            <div class="col-sm-4 col-lg-4">
                                <label class="control-label">Inicial</label>
                                <h:outputText id="stat" styleClass="badge" 
                                              style="background: \##{tipoCasoController.selected.subEstadoInicial.backgroundColor}; color: \##{tipoCasoController.selected.subEstadoInicial.fontColor};" 
                                              value="#{tipoCasoController.selected.subEstadoInicial.nombre}"/> 
                            </div>

                            <div class="col-sm-4 col-lg-4">
                                <label class="control-label">Abierto</label>
                                <ul class="list-group">
                                    <c:forEach items="#{tipoCasoController.selected.getSubEstadosAbierto()}" var="se">
                                        <li class="list-group-item">
                                            <h:outputText styleClass="badge" 
                                                          style="background: \##{se.backgroundColor}; color: \##{se.fontColor};" 
                                                          value="#{se.nombre}"/> 
                                        </li>
                                    </c:forEach>
                                </ul>
                            </div>

                            <div class="col-sm-4 col-lg-4">
                                <label class="control-label">Cerrado</label>
                                <ul class="list-group">
                                    <c:forEach items="#{tipoCasoController.selected.getSubEstadosCerrado()}" var="se">
                                        <li class="list-group-item">
                                            <h:outputText styleClass="badge" 
                                                          style="background: \##{se.backgroundColor}; color: \##{se.fontColor};" 
                                                          value="#{se.nombre}"/> 
                                        </li>
                                    </c:forEach>
                                </ul>
                            </div>
                        </div>

                    </div>

                    <div class="col-sm-7 col-lg-7">
                        <div class="form-group">
                            <label class="control-label">Configuraci贸n de SubEstados (Workflow del caso)</label>

                            <p:dataTable id="SubEstadoCaso_Table" widgetVar="SubEstadoCasoTable" var="item" 
                                         value="#{tipoCasoController.selected.subEstadoCasoList}" 
                                         emptyMessage="#{bundle.ListSubEstadoCasoEmpty}" 
                                         sortBy="#{item.idEstado.nombre}">

                                <p:column sortBy="#{item.idEstado.nombre}" headerText="#{bundle.ListSubEstadoCasoTitle_idEstado}">
                                    <h:outputText value="#{item.idEstado.nombre}"/>
                                </p:column>

                                <p:column headerText="Inicial">
                                    <p:selectBooleanCheckbox id="first" value="#{item.first}" 
                                                             rendered="#{EnumEstadoCaso.ABIERTO.getEstado() eq item.idEstado}"
                                                             label="Es el primer sub-estado de un caso de este tipo." >

                                    </p:selectBooleanCheckbox>
                                </p:column>


                                <p:column sortBy="#{item.nombre}" headerText="#{bundle.ListSubEstadoCasoTitle_nombre}">
                                    <h:inputText styleClass="form-control" value="#{item.nombre}" required="true"
                                                 requiredMessage="El nombre del subestado es requerido."/> 
                                </p:column>

                                <p:column headerText="font">
                                    <p:colorPicker id="fontColor" value="#{item.fontColor}" />
                                </p:column>

                                <p:column headerText="background">
                                    <p:colorPicker id="backgroundColor" value="#{item.backgroundColor}" />
                                </p:column>

                                <p:column headerText="Acci贸n">

                                    <p:commandLink update="SubEstadoCaso_Table" 
                                                   process="@this"
                                                   style="border: none !important;"
                                                   styleClass="btn btn-xs btn-danger btn-outline">
                                        <p:collector unique="true" value="#{item}" 
                                                     removeFrom="#{tipoCasoController.selected.subEstadoCasoList}"/>
                                        <i class="fa fa-times"></i>
                                    </p:commandLink>
                                </p:column>


                            </p:dataTable>

                            <p class="help-block">Nota: 'Inicial' quiere decir el primer sub-estado (del caso) cuando este es creado (Abierto). S贸lo un subEstado puede ser inicial (Seleccione s贸lo uno).</p>

                            <div class="row">
                                <div class="btn-group">
                                    <p:commandLink actionListener="#{tipoCasoController.processAnyValueChange()}"
                                                   styleClass="btn btn-xs btn-default btn-flat" 
                                                   ajax="true" process="@form" update="@form"
                                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                        <i class=""></i> Preview
                                    </p:commandLink>
                                </div>

                                <div class="btn-group">
                                    <p:commandLink actionListener="#{tipoCasoController.processAnyValueChange()}"
                                                   styleClass="btn btn-xs btn-default btn-flat" 
                                                   ajax="true" immediate="true" update="SubEstadoCaso_Table @this"
                                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                        <i class=""></i> Reset
                                    </p:commandLink>
                                </div>

                                <div class="btn-group">
                                    <p:commandLink actionListener="#{tipoCasoController.addNewSubEstadoAbierto()}"
                                                   styleClass="btn btn-xs btn-default btn-flat" 
                                                   ajax="true" immediate="true" update="SubEstadoCaso_Table @this"
                                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                        <i class="fa fa-plus"></i> Agregar Sub-Estado (Abierto)
                                    </p:commandLink>
                                </div>

                                <div class="btn-group">
                                    <p:commandLink actionListener="#{tipoCasoController.addNewSubEstadoCerrado()}"
                                                   styleClass="btn btn-xs btn-default btn-flat" 
                                                   ajax="true" immediate="true" update="SubEstadoCaso_Table @this"
                                                   onclick="jQuery(this).addClass('ui-state-disabled');
                                                           jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                        <i class="fa fa-plus"></i> Agregar Sub-Estado (Cerrado)
                                    </p:commandLink>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4 col-lg-4">
                        <div class="btn-group">
                            <p:commandLink action="#{tipoCasoController.prepareList}" 
                                           styleClass="btn btn-default btn-flat" 
                                           ajax="false" immediate="true"
                                           onclick="jQuery(this).addClass('ui-state-disabled');
                                                   jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                <i class=""></i> #{bundle.Cancel}
                            </p:commandLink>
                        </div>

                        <div class="btn-group">
                            <p:commandLink action="#{tipoCasoController.update}" 
                                           ajax="false"
                                           styleClass="btn btn-primary btn-flat" 
                                           onclick="jQuery(this).addClass('ui-state-disabled');
                                                   jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                <i class=""></i> #{bundle.SaveLink}
                            </p:commandLink>
                        </div>
                    </div>
                </div>


            </h:form>


        </ui:define>
    </ui:composition>

</html>

