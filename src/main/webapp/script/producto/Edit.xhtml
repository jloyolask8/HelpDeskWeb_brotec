<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

    <ui:composition template="/script/template_inbox_bootstrap.xhtml">
        <ui:define name="help">
            <h:outputText  value="#{bundle.ayudaProductos}" escape="false"/>
        </ui:define>
        <ui:define name="body">
            <!-- page-header -->
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-10 col-xs-10">
                        <h1><i class="fa fa-users page-header-icon"></i>&nbsp;&nbsp;Editar Información de #{applicationBean.productDescription} #{productoController.selected.nombre}</h1>
                        <p:commandLink title="Help" onclick="PF('helpDialog').show()" styleClass="text-info" >
                            <i class="fa fa-info-circle"/>
                        </p:commandLink> 
                    </div>

                </div>
            </div><!-- / .page-header --> 

            <h:form id="form">
                <p:messages globalOnly="true"/>

                <div class="row">
                    <div class="col-sm-6 col-lg-4">

                        <div class="form-group">
                            <label class="control-label">Código #{applicationBean.productDescription}:</label>
                            <h:inputText styleClass="form-control" id="codigo" value="#{productoController.selected.idProducto}"  
                                         required="true" requiredMessage="#{bundle.RequiredMessage}" 
                                         disabled="true" readonly="true"/>
                            <h:message for="codigo" errorClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label class="control-label">#{bundle.CreateProductoLabel_nombre}</label>
                            <h:inputText styleClass="form-control" id="nombre" value="#{productoController.selected.nombre}"  required="true" requiredMessage="#{bundle.RequiredMessage}"/>
                            <h:message for="nombre" errorClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label class="control-label">#{bundle.CreateProductoLabel_descripcion}</label>
                            <p:inputTextarea styleClass="form-control" id="descripcion" value="#{productoController.selected.descripcion}" autoResize="true" cols="50" />
                            <h:message for="descripcion" errorClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label class="control-label">Canal de salida por defecto</label>
                            <h:selectOneMenu styleClass="form-control" id="idCanalSalida" style="width: 220px;"
                                             value="#{productoController.selected.idOutCanal}" >
                                <f:selectItems value="#{canalController.emailsAvailableSelectOne}" var="tipo" itemLabel="#{tipo.nombre}" itemValue="#{tipo}" itemDescription="#{tipo.descripcion}"/>
                            </h:selectOneMenu>
                            <h:message for="idCanalSalida" errorClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label class="control-label">Logo del #{applicationBean.productDescription}</label><br/>
                            <p:commandLink styleClass="btn btn-sm btn-outline btn-primary" value="adjuntar un Logo" onclick="PF('uploadLogoProyectoDialog').show()"
                                           rendered="#{productoController.selected.idLogo eq null}"/>

                            <h:panelGrid columns="4"  rendered="#{productoController.selected.idLogo ne null}">

                                <p:graphicImage id="imageLogoPreview0" 
                                                value="#{productoController.logo}" cache="false"/>&nbsp;&nbsp;&nbsp;&nbsp;

                                <p:commandLink styleClass="btn btn-sm btn-outline btn-primary" ajax="false">
                                    <p:fileDownload value="#{productoController.downloadArchivo(productoController.selected.idLogo)}" /><i class="fa fa-download"/>
                                </p:commandLink>

                                <p:commandLink styleClass="btn btn-sm btn-outline btn-danger" update=":formBorrarLogo :uploadLogoProyectoForm"
                                               onclick="PF('borrarLogo').show();">
                                    <f:setPropertyActionListener target="#{productoController.idFileDelete}" 
                                                                 value="#{productoController.selected.idLogo}"/><i class="fa fa-times"/>
                                </p:commandLink>
                            </h:panelGrid>

                        </div>

                        <div class="btn-group">
                            <p:commandLink action="#{productoController.prepareList}" 
                                           styleClass="btn btn-default btn-flat" 
                                           ajax="false" immediate="true"
                                           onclick="jQuery(this).addClass('ui-state-disabled');
                                                   jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                <i class=""></i> #{bundle.Cancel}
                            </p:commandLink>
                        </div>

                        <div class="btn-group">
                            <p:commandLink action="#{productoController.update}" 
                                           ajax="false"
                                           styleClass="btn btn-primary btn-flat" 
                                           onclick="jQuery(this).addClass('ui-state-disabled');
                                                   jQuery(this).children().addClass('fa fa-refresh fa-spin')">
                                <i class=""></i> #{bundle.SaveLink}
                            </p:commandLink>
                        </div>

                        <div class="btn-group">
                            <p:commandLink id="showDialogButton"  
                                           styleClass="btn btn-primary btn-flat" 
                                           onclick="PF('confirmation').show()">
                                <i class=""></i> #{bundle.DestroyLink}
                            </p:commandLink>
                        </div>

                    </div>
                </div>
                <br/>
            </h:form>


        </ui:define>

        <ui:define name="dialogs">

            <p:dialog header="Confirma que desea borrar el logo" widgetVar="borrarLogo" modal="true" appendTo="@(body)">
                <h:form id="formBorrarLogo">
                    <label>¿Esta seguro de borrar el Logo #{productoController.getFileName(productoController.idFileDelete)}?</label>
                    <br/>
                    <br/>
                    <div style="text-align: right">                       
                        <p:commandLink styleClass="btn btn-primary btn-flat" value="Si, Eliminar" update=":mainform:messages :form :uploadLogoProyectoForm"
                                       actionListener="#{productoController.deleteLogoProducto(actionEvent)}" />&nbsp;&nbsp;

                        <p:commandLink styleClass="btn btn-default btn-flat" value="No" onclick="PF('borrarLogo').hide()" type="button" />
                    </div>
                </h:form>
            </p:dialog>

            <h:form id="uploadLogoProyectoForm" enctype="multipart/form-data">
                <p:dialog id="uploadLogoProyectoDialog" showEffect="fade" hideEffect="fade"  
                          header="Adjuntar Logo" widgetVar="uploadLogoProyectoDialog">

                    <p:fileUpload id="fileupload"
                                  sizeLimit="5242880"
                                  allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                                  invalidSizeMessage="El archivo excede el tamaño maximo: 5MB."
                                  fileUploadListener="#{productoController.uploadLogoProducto}"
                                  disabled="#{productoController.selected.idLogo ne null}"
                                  rendered="true"
                                  label="seleccionar archivo"
                                  uploadLabel="Subir"
                                  cancelLabel="Cancelar Subida"
                                  invalidFileMessage="Archivo Invalido." 
                                  mode="advanced"
                                  dragDropSupport="true"
                                  auto="true"
                                  update=":mainform:messages :form :uploadLogoProyectoForm"
                                  multiple="false"  
                                  />

                    <f:facet name="footer">

                    </f:facet>  
                </p:dialog>
            </h:form>
            <h:form id="formconfirmDialog">
                <p:dialog id="confirmDialog" showEffect="fade" hideEffect="fade" 
                          header="Iniciando proceso de eliminación" widgetVar="confirmation">

                    <h:outputText value="Está seguro de eliminar el #{applicationBean.productDescription}:  #{productoController.selected.nombre}?"/>

                    <f:facet name="footer">
                        <p:commandLink styleClass="btn btn-primary btn-flat" id="confirm" ajax="false" value="#{bundle.yesDelete}" action="#{productoController.destroy()}" 
                                       update=":form" oncomplete="PF('confirmation').hide()"/>&nbsp;&nbsp;
                        <p:commandLink styleClass="btn btn-default btn-flat" id="decline" value="#{bundle.decline}" onclick="PF('confirmation').hide()" type="button" /> 
                    </f:facet>

                </p:dialog>
            </h:form>
        </ui:define>
    </ui:composition>

</html>