<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html [
    <!ENTITY nbsp "&#160;"> 
    ]>
    <html xmlns="http://www.w3.org/1999/xhtml"
          xmlns:h="http://java.sun.com/jsf/html"
          xmlns:f="http://java.sun.com/jsf/core"
          xmlns:p="http://primefaces.org/ui"
          xmlns:composite="http://java.sun.com/jsf/composite"
          xmlns:go="http://java.sun.com/jsf/composite/go">
        <composite:interface>
            <composite:attribute name="controllerMBean" required="true" /> 
            <composite:attribute name="vista" required="true" /> 
            <composite:attribute name="filterHelper" required="true" /> 
            <composite:attribute name="showApplyAction" default="true" />
            <composite:attribute name="showSearchBar" default="true" />
            <composite:attribute name="showSaveAs" default="true" />
            <composite:attribute name="showEdit" default="true" />
            <composite:attribute name="titleIconClass" default="" /> 
            <composite:attribute name="canChangeFilters" default="true" />
            <composite:attribute name="update" default=":mainform:messages" />
            <composite:attribute name="vistaControllerBackOutcome" required="false"  />
            <composite:facet name="header" />
            <composite:facet name="saveView" />
        </composite:interface>

        <composite:implementation>

            <p:panel id="panelFilter"  styleClass="panelFilter" style="border: none !important;">

                <h:panelGrid columns="5" rendered="#{cc.attrs.showSearchBar}" style="padding: 0">

                    <h:inputText id="query" styleClass="query" value="#{cc.attrs.controllerMBean.query}" size="64" />

                    <p:commandButton id="simpleSearchBtn" ajax="true" update="#{cc.attrs.update}" icon="fa fa-search" 
                                     title="" 
                                     iconPos="notext"
                                     actionListener="#{cc.attrs.controllerMBean.filter()}"/>

                    <p:commandButton id="filterPanelToggle" 
                                     ajax="true"
                                     update="panelFilter"
                                     disabled="#{not cc.attrs.canChangeFilters}"
                                     title="#{cc.attrs.controllerMBean.filterViewToggle ? 'Ocultar filtros':'Ver filtro avanzado'}"
                                     immediate="true" icon="#{cc.attrs.controllerMBean.filterViewToggle ? 'fa fa-caret-square-o-up ':'fa fa-caret-square-o-down '}">

                        <f:setPropertyActionListener target="#{cc.attrs.controllerMBean.filterViewToggle}" 
                                                     value="#{not cc.attrs.controllerMBean.filterViewToggle}"/>

                    </p:commandButton>
                    <p:watermark for="query" value="#{empty cc.attrs.vista ? 'Search':'Search in '.concat(cc.attrs.vista.nombre)}"/>
                    <p:tooltip for="simpleSearchBtn" value="#{empty cc.attrs.vista ? 'Search all':'Search in '.concat(cc.attrs.vista.nombre)}"/>
                </h:panelGrid>


                <p:panel id="filters"  visible="#{(cc.attrs.showSearchBar and cc.attrs.controllerMBean.filterViewToggle) or (not cc.attrs.showSearchBar)}" style="border: none !important;">

                    <!--<p:fieldset legend="Filtros">-->

                    <h:dataTable id="filtrosVista" value="#{cc.attrs.vista.filtrosVistaList}" var="filtro" 
                                 styleClass="hide-column-names" rules="none"
                                 style="width: 730px; table-layout: fixed; border: slategray solid thin !important;"
                                 rowClasses="order-table-odd-row,order-table-even-row">     


                        <p:column style="border: none !important;" styleClass="">
                            <go:entityCriteria id="entityCriteria"
                                               removeActionListener="#{cc.attrs.vista.removeFiltroFromVista(filtro)}"
                                               addActionListener="#{cc.attrs.vista.addNewFiltroVista(filtro)}"
                                               filterHelper="#{cc.attrs.filterHelper}" filtro="#{filtro}" 
                                               canChangeFilters="#{cc.attrs.canChangeFilters}"
                                               canRemoveFilter="#{cc.attrs.vista.canRemoveFiltroVista()}"
                                               requiredAttribute="#{cc.attrs.showApplyAction?'false':'true'}"/>
                        </p:column>

                    </h:dataTable>
                    <!--</p:fieldset>-->
                    <br/>


                    <div align="right" style="width: 730px;">
                        <p:outputLabel for="allMustMatch" value="Cuando "/>
                        <p:selectBooleanButton id="allMustMatch" style="height: 20px; font-size: x-small !important;"
                                               value="#{cc.attrs.vista.allMustMatch}" 
                                               onLabel="Todas" offLabel="Cualquiera" 
                                               >
                            <p:ajax update="@form #{cc.attrs.update}" listener="#{cc.attrs.controllerMBean.filter()}" />
                        </p:selectBooleanButton>
                        <p:outputLabel for="allMustMatch" value="se cumplan"/>
                        &nbsp;
                        <p:commandButton value="Editar Vista" style="height: 20px; font-size: x-small !important;"
                                         rendered="#{(cc.attrs.showEdit) and (cc.attrs.vista.idUsuarioCreadaPor eq UserSessionBean.current
                                                     or filtroAcceso.administradorDelSistema)}" 
                                         disabled="#{cc.attrs.vista.idVista eq null or not filtroAcceso.verificarAccesoAFuncionAdministrarVistas()}"
                                         action="#{vistaController.prepareEditPK(cc.attrs.vista.idVista, cc.attrs.vistaControllerBackOutcome)}"                                                  
                                         immediate="true" ajax="false"
                                         icon="ui-icon-pencil"/>
                        &nbsp;
                        <p:commandButton id="linkGuardar" style="height: 20px; font-size: x-small !important;"
                                         rendered="#{cc.attrs.showSaveAs}"
                                         action="#{vistaController.prepareCreate(cc.attrs.vista, cc.attrs.vistaControllerBackOutcome)}"
                                         ajax="false"
                                         disabled="#{not filtroAcceso.verificarAccesoAFuncionAdministrarVistas()}"
                                         value="Guardar como.."
                                         immediate="true" icon="ui-icon-disk"/>
                        &nbsp;
                        <p:commandButton id="linkAplicar" ajax="true" update="@form #{cc.attrs.update}" icon="ui-icon-play" 
                                         rendered="#{cc.attrs.showApplyAction}" style="height: 20px; font-size: x-small !important;"
                                         title="Aplicar Filtro" 
                                         disabled="#{not cc.attrs.canChangeFilters}"
                                         value="#{empty cc.attrs.vista.filtrosVistaList ? 'Desplegar Todo':'Filtrar' }"
                                         actionListener="#{cc.attrs.controllerMBean.filter()}"/>      


                    </div>
                </p:panel>



            </p:panel>


        </composite:implementation>
    </html>




